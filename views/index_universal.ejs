<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
  <title>誠意鮮蔬｜全齡友善蔬果購物 - 為每一位消費者設計</title>
  
  <!-- 無障礙和SEO優化 -->
  <meta name="description" content="新鮮蔬果外送，服務三峽、樹林、鶯歌、土城、北大地區。為長輩、年輕人、視障朋友都能輕鬆使用的友善購物平台">
  <meta name="keywords" content="蔬果外送,新鮮蔬菜,三峽外送,樹林外送,無障礙購物,長輩友善">
  
  <!-- PWA設定 -->
  <meta name="theme-color" content="#2d5a3d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="誠意鮮蔬">
  
  <!-- 無障礙支援 -->
  <meta name="color-scheme" content="light dark">
  
  <style>
    /* =================================================
       🌍 SUB AGENT團隊 - 全民友善設計系統
       周全考慮所有消費者的使用體驗
       ================================================= */
    
    /* 🎨 CSS 自訂屬性 - 支援主題切換 */
    :root {
      /* 基礎色彩 */
      --primary-color: #2d5a3d;
      --accent-color: #7cb342;
      --background-color: #ffffff;
      --surface-color: #f8fffe;
      --text-primary: #1a1a1a;
      --text-secondary: #666666;
      --border-color: rgba(124, 179, 66, 0.2);
      --error-color: #d32f2f;
      --success-color: #2e7d32;
      --warning-color: #f57c00;
      
      /* 字體尺寸 - 可調整 */
      --font-size-small: 0.875rem;
      --font-size-base: 1rem;
      --font-size-large: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-xxl: 1.5rem;
      
      /* 間距系統 */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      
      /* 觸控目標最小尺寸 */
      --min-touch-size: 44px;
      --comfortable-touch-size: 48px;
      
      /* 動畫時間 */
      --animation-fast: 0.15s;
      --animation-normal: 0.3s;
      --animation-slow: 0.5s;
    }
    
    /* 🌙 深色模式支援 */
    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #121212;
        --surface-color: #1e1e1e;
        --text-primary: #ffffff;
        --text-secondary: #b3b3b3;
        --border-color: rgba(124, 179, 66, 0.3);
      }
    }
    
    /* 📱 動態文字大小支援 */
    @media (prefers-font-size: large) {
      :root {
        --font-size-small: 1rem;
        --font-size-base: 1.125rem;
        --font-size-large: 1.25rem;
        --font-size-xl: 1.5rem;
        --font-size-xxl: 1.75rem;
      }
    }
    
    /* 🎯 高對比度支援 */
    @media (prefers-contrast: high) {
      :root {
        --border-color: #000000;
        --text-secondary: #000000;
      }
      
      .product-card {
        border: 2px solid #000000 !important;
      }
      
      .btn-primary {
        border: 2px solid #000000 !important;
      }
    }
    
    /* ♿ 動畫減少支援 */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
    
    /* 📏 基礎重置和字體 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 
        -apple-system, 
        BlinkMacSystemFont, 
        'Segoe UI', 
        'PingFang TC', 
        'Hiragino Sans GB', 
        'Microsoft JhengHei', 
        'Helvetica Neue', 
        Arial, 
        sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: var(--font-size-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color var(--animation-normal) ease;
    }
    
    /* 📱 容器系統 */
    .container {
      width: 100%;
      max-width: 430px;
      margin: 0 auto;
      padding: 0 var(--spacing-md);
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
        padding: 0 var(--spacing-lg);
      }
    }
    
    /* =================================================
       🏪 頂部導航 - 全齡友善
       ================================================= */
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-lg) 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brand {
      display: flex;
      flex-direction: column;
    }
    
    .brand-name {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
      color: white;
    }
    
    .brand-tagline {
      font-size: var(--font-size-small);
      opacity: 0.9;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .header-actions {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    /* 🔘 按鈕系統 - 觸控友善 */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: var(--min-touch-size);
      min-width: var(--min-touch-size);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: 8px;
      font-size: var(--font-size-base);
      font-weight: 500;
      text-decoration: none;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .btn:focus {
      outline: 3px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    .btn-primary {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    
    .btn-primary:hover,
    .btn-primary:focus {
      background-color: #6da632;
      border-color: #6da632;
    }
    
    .btn-secondary {
      background-color: transparent;
      color: var(--text-primary);
      border-color: var(--border-color);
    }
    
    .btn-secondary:hover,
    .btn-secondary:focus {
      background-color: var(--surface-color);
      border-color: var(--accent-color);
    }
    
    .btn-large {
      min-height: var(--comfortable-touch-size);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-large);
      font-weight: 600;
    }
    
    .btn-icon {
      width: var(--min-touch-size);
      height: var(--min-touch-size);
      border-radius: 50%;
      padding: 0;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    /* =================================================
       🔍 搜尋系統 - 智能輔助
       ================================================= */
    .search-section {
      background-color: var(--surface-color);
      padding: var(--spacing-lg) 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .search-wrapper {
      position: relative;
    }
    
    .search-input {
      width: 100%;
      min-height: var(--comfortable-touch-size);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      border: 2px solid var(--border-color);
      border-radius: 24px;
      background-color: var(--background-color);
      color: var(--text-primary);
      transition: all var(--animation-normal) ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.1);
    }
    
    .search-input::placeholder {
      color: var(--text-secondary);
      font-size: var(--font-size-base);
    }
    
    /* 🏷️ 分類標籤 - 水平滾動 */
    .categories-section {
      background-color: var(--background-color);
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .categories-scroll {
      display: flex;
      gap: var(--spacing-sm);
      overflow-x: auto;
      padding: var(--spacing-sm) var(--spacing-md);
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: var(--accent-color) var(--surface-color);
    }
    
    .categories-scroll::-webkit-scrollbar {
      height: 4px;
    }
    
    .categories-scroll::-webkit-scrollbar-track {
      background: var(--surface-color);
      border-radius: 2px;
    }
    
    .categories-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 2px;
    }
    
    .category-btn {
      flex-shrink: 0;
      min-height: var(--min-touch-size);
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-base);
      font-weight: 500;
      white-space: nowrap;
      border-radius: 22px;
      background-color: var(--surface-color);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      cursor: pointer;
      transition: all var(--animation-normal) ease;
    }
    
    .category-btn:hover,
    .category-btn:focus,
    .category-btn.active {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    
    /* =================================================
       📢 服務公告 - 資訊透明
       ================================================= */
    .service-info {
      background-color: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin: var(--spacing-lg) var(--spacing-md);
      overflow: hidden;
    }
    
    .service-header {
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      min-height: var(--min-touch-size);
    }
    
    .service-title {
      font-size: var(--font-size-large);
      font-weight: 600;
      margin: 0;
    }
    
    .service-toggle {
      background: none;
      border: none;
      color: white;
      font-size: var(--font-size-large);
      cursor: pointer;
      min-width: var(--min-touch-size);
      min-height: var(--min-touch-size);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color var(--animation-normal) ease;
    }
    
    .service-toggle:hover,
    .service-toggle:focus {
      background-color: rgba(255, 255, 255, 0.1);
      outline: 2px solid rgba(255, 255, 255, 0.3);
      outline-offset: 2px;
    }
    
    .service-content {
      padding: var(--spacing-lg);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-lg);
    }
    
    .service-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background-color: var(--background-color);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .service-icon {
      font-size: var(--font-size-xl);
      flex-shrink: 0;
    }
    
    .service-text {
      flex: 1;
    }
    
    .service-text strong {
      display: block;
      font-size: var(--font-size-large);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .service-text span {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    /* =================================================
       🛍️ 商品展示 - 無障礙卡片
       ================================================= */
    .products-section {
      padding: var(--spacing-xl) 0 120px;
      background-color: var(--background-color);
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-lg);
      padding: 0 var(--spacing-md);
    }
    
    @media (max-width: 600px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--spacing-md);
      }
    }
    
    @media (max-width: 400px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .product-card {
      background-color: var(--background-color);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: var(--spacing-lg);
      transition: all var(--animation-normal) ease;
      cursor: pointer;
      position: relative;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }
    
    .product-card:hover,
    .product-card:focus-within {
      border-color: var(--accent-color);
      box-shadow: 0 4px 16px rgba(124, 179, 66, 0.15);
      transform: translateY(-2px);
    }
    
    .product-card:focus {
      outline: 3px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    .product-image {
      text-align: center;
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-lg);
      background-color: var(--surface-color);
      border-radius: 8px;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .product-emoji {
      font-size: 4rem;
      line-height: 1;
    }
    
    .product-image img {
      max-width: 100%;
      max-height: 120px;
      object-fit: cover;
      border-radius: 6px;
    }
    
    .product-info {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .product-name {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      line-height: 1.3;
    }
    
    .product-price {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      color: var(--accent-color);
      margin-bottom: var(--spacing-sm);
    }
    
    .product-unit {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
    }
    
    .product-badge {
      display: inline-block;
      background-color: #fff3e0;
      color: #f57c00;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: 16px;
      font-size: var(--font-size-small);
      font-weight: 500;
      border: 1px solid #ffcc02;
      margin-bottom: var(--spacing-md);
    }
    
    .product-actions {
      margin-top: auto;
      display: flex;
      gap: var(--spacing-sm);
    }
    
    .quick-add-btn {
      flex: 1;
      min-height: var(--comfortable-touch-size);
      background-color: var(--accent-color);
      color: white;
      border: 2px solid var(--accent-color);
      border-radius: 8px;
      font-size: var(--font-size-base);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }
    
    .quick-add-btn:hover,
    .quick-add-btn:focus {
      background-color: #6da632;
      border-color: #6da632;
      transform: translateY(-1px);
    }
    
    .detail-btn {
      min-width: var(--comfortable-touch-size);
      min-height: var(--comfortable-touch-size);
      background-color: var(--surface-color);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .detail-btn:hover,
    .detail-btn:focus {
      border-color: var(--accent-color);
      background-color: var(--accent-color);
      color: white;
    }
    
    /* =================================================
       🛒 購物車 - 固定底部
       ================================================= */
    .cart-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-lg);
      box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.1);
      z-index: 200;
      transform: translateY(100%);
      transition: transform var(--animation-normal) ease;
    }
    
    .cart-bar.visible {
      transform: translateY(0);
    }
    
    .cart-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 430px;
      margin: 0 auto;
    }
    
    .cart-info {
      flex: 1;
    }
    
    .cart-total {
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
    }
    
    .cart-count {
      font-size: var(--font-size-base);
      opacity: 0.9;
    }
    
    .cart-btn {
      min-width: var(--comfortable-touch-size);
      min-height: var(--comfortable-touch-size);
      background-color: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-xl);
    }
    
    .cart-btn:hover,
    .cart-btn:focus {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    /* =================================================
       🎭 模態框系統
       ================================================= */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-lg);
      opacity: 0;
      visibility: hidden;
      transition: all var(--animation-normal) ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background-color: var(--background-color);
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      max-height: 90vh;
      overflow: hidden;
      transform: scale(0.9) translateY(20px);
      transition: transform var(--animation-normal) ease;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .modal-overlay.active .modal {
      transform: scale(1) translateY(0);
    }
    
    .modal-header {
      background-color: var(--accent-color);
      color: white;
      padding: var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      margin: 0;
    }
    
    .modal-close {
      width: var(--min-touch-size);
      height: var(--min-touch-size);
      background: none;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-large);
    }
    
    .modal-close:hover,
    .modal-close:focus {
      background-color: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }
    
    .modal-body {
      padding: var(--spacing-lg);
      overflow-y: auto;
      max-height: calc(90vh - 120px);
    }
    
    /* =================================================
       💬 用戶回饋系統
       ================================================= */
    .feedback-toast {
      position: fixed;
      top: var(--spacing-lg);
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--success-color);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: 8px;
      font-weight: 500;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--animation-normal) ease;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }
    
    .feedback-toast.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    
    .feedback-toast.error {
      background-color: var(--error-color);
    }
    
    .feedback-toast.warning {
      background-color: var(--warning-color);
    }
    
    /* =================================================
       🔧 工具類別
       ================================================= */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: white;
      padding: 8px;
      text-decoration: none;
      z-index: 1001;
      border-radius: 4px;
    }
    
    .skip-link:focus {
      top: 6px;
    }
    
    .loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-color);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* =================================================
       📱 響應式斷點
       ================================================= */
    @media (max-width: 480px) {
      .container {
        padding: 0 var(--spacing-sm);
      }
      
      .service-content {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }
      
      .product-card {
        padding: var(--spacing-md);
      }
      
      .product-actions {
        flex-direction: column;
      }
    }
    
    @media (min-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      }
    }
  </style>
</head>

<body>
  <!-- ♿ 無障礙跳轉連結 -->
  <a href="#main" class="skip-link">跳到主要內容</a>
  
  <!-- 🏪 網站標題 -->
  <header class="header" role="banner">
    <div class="container">
      <div class="header-content">
        <div class="brand">
          <h1 class="brand-name">誠意鮮蔬</h1>
          <p class="brand-tagline">新鮮蔬果｜全齡友善購物</p>
        </div>
        
        <div class="header-actions" role="navigation" aria-label="使用者功能">
          <% if (sessionLine) { %>
            <span class="btn btn-icon" aria-label="LINE 已綁定" title="LINE 已綁定">
              ✅
            </span>
          <% } else { %>
            <a href="/auth/line/login" class="btn btn-icon" aria-label="綁定 LINE 帳號">
              📱
            </a>
          <% } %>
          
          <button class="btn btn-icon" onclick="toggleTheme()" aria-label="切換深淺色主題" id="theme-toggle">
            🌙
          </button>
          
          <button class="btn btn-icon" onclick="toggleFontSize()" aria-label="調整字體大小" id="font-toggle">
            Aa
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- 🔍 搜尋功能 -->
  <section class="search-section" role="search">
    <div class="container">
      <div class="search-wrapper">
        <label for="search-input" class="sr-only">搜尋商品</label>
        <input 
          type="search" 
          id="search-input"
          class="search-input"
          placeholder="搜尋新鮮蔬果商品..."
          autocomplete="off"
          role="searchbox"
          aria-describedby="search-help">
        <div id="search-help" class="sr-only">輸入商品名稱進行搜尋</div>
      </div>
    </div>
  </section>

  <!-- 🏷️ 商品分類 -->
  <section class="categories-section" role="navigation" aria-label="商品分類">
    <div class="container">
      <div class="categories-scroll" role="tablist">
        <button class="category-btn active" data-category="all" role="tab" aria-selected="true" aria-controls="products-grid">
          🌟 全部商品
        </button>
        <button class="category-btn" data-category="leafy" role="tab" aria-selected="false" aria-controls="products-grid">
          🥬 葉菜類
        </button>
        <button class="category-btn" data-category="root" role="tab" aria-selected="false" aria-controls="products-grid">
          🥕 根莖類
        </button>
        <button class="category-btn" data-category="fruits" role="tab" aria-selected="false" aria-controls="products-grid">
          🍎 水果類
        </button>
        <button class="category-btn" data-category="herbs" role="tab" aria-selected="false" aria-controls="products-grid">
          🌿 調料香草
        </button>
        <button class="category-btn" data-category="proxy" role="tab" aria-selected="false" aria-controls="products-grid">
          📦 代購商品
        </button>
      </div>
    </div>
  </section>

  <!-- 📢 服務資訊 -->
  <section class="service-info" role="region" aria-labelledby="service-title">
    <div class="service-header" onclick="toggleServiceInfo()" role="button" aria-expanded="false" aria-controls="service-content" tabindex="0">
      <h2 class="service-title" id="service-title">📢 服務資訊</h2>
      <button class="service-toggle" aria-label="展開或收合服務資訊" id="service-toggle">
        ▼
      </button>
    </div>
    
    <div class="service-content" id="service-content" aria-hidden="false">
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">🚚</div>
        <div class="service-text">
          <strong>配送範圍</strong>
          <span>三峽、北大特區、鶯歌、樹林、土城地區</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">💰</div>
        <div class="service-text">
          <strong>外送門檻</strong>
          <span>單筆訂單滿 200 元享免費外送</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">💳</div>
        <div class="service-text">
          <strong>付款方式</strong>
          <span>現金、LINE Pay、銀行轉帳</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">⏰</div>
        <div class="service-text">
          <strong>配送時間</strong>
          <span>當天11點前下單，當日新鮮送達</span>
        </div>
      </div>
    </div>
  </section>

  <!-- 🛍️ 商品展示 -->
  <main class="products-section" role="main" id="main">
    <div class="container">
      <h2 class="sr-only">商品列表</h2>
      
      <% if (!products || products.length === 0) { %>
        <div role="status" aria-live="polite" style="text-align: center; padding: 3rem 1rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem;" aria-hidden="true">🥬</div>
          <h3 style="font-size: var(--font-size-xl); margin-bottom: 0.5rem;">暫無商品</h3>
          <p style="color: var(--text-secondary); margin-bottom: 2rem;">請稍後再試或聯絡客服</p>
          <button onclick="location.reload()" class="btn btn-primary btn-large">
            重新載入
          </button>
        </div>
      <% } else { %>
        <div class="products-grid" id="products-grid" role="tabpanel" aria-labelledby="category-all">
          <% products.forEach(function(product) { %>
            <article class="product-card" 
                     data-category="<%= product.is_priced_item ? 'proxy' : 'leafy' %>"
                     role="article"
                     aria-labelledby="product-<%= product.id %>-name"
                     tabindex="0">
              
              <div class="product-image" role="img" aria-label="<%= product.name %> 商品圖片">
                <% if (product.image_url && product.image_url.startsWith('/uploads/')) { %>
                  <img src="<%= product.image_url %>" 
                       alt="<%= product.name %>" 
                       loading="lazy"
                       onerror="this.parentElement.innerHTML='<div class=&quot;product-emoji&quot;>🥬</div>'">
                <% } else if (product.image_url) { %>
                  <div class="product-emoji" aria-hidden="true"><%= product.image_url %></div>
                <% } else { %>
                  <div class="product-emoji" aria-hidden="true">🥬</div>
                <% } %>
              </div>
              
              <div class="product-info">
                <h3 class="product-name" id="product-<%= product.id %>-name">
                  <%= product.name %>
                </h3>
                
                <% if (product.is_priced_item) { %>
                  <div class="product-price" aria-label="時價商品">時價</div>
                  <div class="product-unit">依重量計算</div>
                  <div class="product-badge">計價商品</div>
                <% } else { %>
                  <div class="product-price" aria-label="價格 <%= product.price %> 元">$<%= product.price %></div>
                  <div class="product-unit">/ <%= product.unit || '份' %></div>
                <% } %>
                
                <div class="product-actions">
                  <button class="quick-add-btn" 
                          onclick="quickAddToCart(<%= product.id %>)"
                          aria-describedby="product-<%= product.id %>-name"
                          <% if (product.is_priced_item) { %>disabled<% } %>>
                    <span aria-hidden="true">🛒</span>
                    <span>加入購物車</span>
                  </button>
                  
                  <button class="detail-btn" 
                          onclick="openProductDetail(<%= product.id %>)"
                          aria-label="查看 <%= product.name %> 詳細資訊">
                    <span aria-hidden="true">ℹ️</span>
                  </button>
                </div>
              </div>
            </article>
          <% }) %>
        </div>
      <% } %>
    </div>
  </main>

  <!-- 🛒 購物車 -->
  <div class="cart-bar" id="cart-bar" role="complementary" aria-label="購物車">
    <div class="cart-content">
      <div class="cart-info">
        <div class="cart-total" aria-live="polite">
          總計 $<span id="cart-total">0</span>
        </div>
        <div class="cart-count" aria-live="polite">
          <span id="cart-count">0</span> 項商品
        </div>
      </div>
      
      <button class="cart-btn" 
              onclick="openCart()"
              aria-label="開啟購物車，目前有 0 項商品"
              id="cart-button">
        <span aria-hidden="true">🛒</span>
      </button>
    </div>
  </div>

  <!-- 🎭 商品詳情彈窗 -->
  <div class="modal-overlay" id="product-modal" role="dialog" aria-labelledby="product-modal-title" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="product-modal-title">商品詳情</h2>
        <button class="modal-close" onclick="closeProductDetail()" aria-label="關閉商品詳情">
          <span aria-hidden="true">✕</span>
        </button>
      </div>
      
      <div class="modal-body" id="product-modal-body">
        <!-- 動態內容 -->
      </div>
    </div>
  </div>

  <!-- 🛒 購物車彈窗 -->
  <div class="modal-overlay" id="cart-modal" role="dialog" aria-labelledby="cart-modal-title" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="cart-modal-title">購物車</h2>
        <button class="modal-close" onclick="closeCart()" aria-label="關閉購物車">
          <span aria-hidden="true">✕</span>
        </button>
      </div>
      
      <div class="modal-body" id="cart-modal-body">
        <!-- 動態內容 -->
      </div>
    </div>
  </div>

  <!-- 💬 回饋訊息 -->
  <div class="feedback-toast" id="feedback-toast" role="status" aria-live="polite"></div>

  <script>
    // =================================================
    // 🌍 全民友善 JavaScript - 無障礙優先
    // =================================================
    
    // 🔧 全域變數
    const products = <%- JSON.stringify(products || []) %>;
    let cart = JSON.parse(localStorage.getItem('universalCart') || '[]');
    let currentTheme = localStorage.getItem('theme') || 'light';
    let currentFontSize = localStorage.getItem('fontSize') || 'normal';
    let isServiceExpanded = false;
    
    // 🎯 頁面初始化
    document.addEventListener('DOMContentLoaded', function() {
      initializeAccessibility();
      initializeTheme();
      initializeFontSize();
      initializeSearch();
      initializeCategories();
      updateCartDisplay();
      
      // 載入完成通知
      announceToScreenReader('頁面載入完成，共 ' + products.length + ' 項商品');
    });
    
    // ♿ 無障礙功能初始化
    function initializeAccessibility() {
      // 鍵盤導航支援
      document.addEventListener('keydown', handleKeyboardNavigation);
      
      // 焦點管理
      setupFocusManagement();
      
      // ARIA 狀態管理
      setupAriaStates();
    }
    
    // ⌨️ 鍵盤導航處理
    function handleKeyboardNavigation(e) {
      // ESC 鍵關閉彈窗
      if (e.key === 'Escape') {
        closeAllModals();
      }
      
      // Enter 或 Space 鍵啟動按鈕
      if ((e.key === 'Enter' || e.key === ' ') && e.target.role === 'button') {
        e.preventDefault();
        e.target.click();
      }
      
      // Tab 鍵管理焦點
      if (e.key === 'Tab') {
        manageFocusWithinModals(e);
      }
    }
    
    // 🎨 主題切換功能
    function initializeTheme() {
      document.documentElement.setAttribute('data-theme', currentTheme);
      updateThemeButton();
    }
    
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
      updateThemeButton();
      
      announceToScreenReader('已切換到' + (currentTheme === 'light' ? '淺色' : '深色') + '主題');
    }
    
    function updateThemeButton() {
      const themeButton = document.getElementById('theme-toggle');
      themeButton.textContent = currentTheme === 'light' ? '🌙' : '☀️';
      themeButton.setAttribute('aria-label', '切換到' + (currentTheme === 'light' ? '深色' : '淺色') + '主題');
    }
    
    // 📝 字體大小調整
    function initializeFontSize() {
      document.documentElement.setAttribute('data-font-size', currentFontSize);
      updateFontButton();
    }
    
    function toggleFontSize() {
      const sizes = ['small', 'normal', 'large', 'xl'];
      const currentIndex = sizes.indexOf(currentFontSize);
      const nextIndex = (currentIndex + 1) % sizes.length;
      currentFontSize = sizes[nextIndex];
      
      document.documentElement.setAttribute('data-font-size', currentFontSize);
      localStorage.setItem('fontSize', currentFontSize);
      updateFontButton();
      
      const sizeNames = { small: '小', normal: '標準', large: '大', xl: '特大' };
      announceToScreenReader('字體大小已調整為' + sizeNames[currentFontSize]);
    }
    
    function updateFontButton() {
      const fontButton = document.getElementById('font-toggle');
      const sizeLabels = { small: 'Aa', normal: 'Aa', large: 'AA', xl: 'AA' };
      fontButton.textContent = sizeLabels[currentFontSize];
    }
    
    // 🔍 搜尋功能
    function initializeSearch() {
      const searchInput = document.getElementById('search-input');
      let searchTimeout;
      
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performSearch(this.value);
        }, 500); // 增加防抖時間，對認知障礙友善
      });
    }
    
    function performSearch(query) {
      const cards = document.querySelectorAll('.product-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const name = card.querySelector('.product-name').textContent.toLowerCase();
        const shouldShow = !query || name.includes(query.toLowerCase());
        
        card.style.display = shouldShow ? 'flex' : 'none';
        card.setAttribute('aria-hidden', !shouldShow);
        
        if (shouldShow) visibleCount++;
      });
      
      announceToScreenReader('搜尋結果：找到 ' + visibleCount + ' 項商品');
    }
    
    // 🏷️ 分類功能
    function initializeCategories() {
      const categoryButtons = document.querySelectorAll('.category-btn');
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          setActiveCategory(this);
          filterByCategory(this.dataset.category);
        });
      });
    }
    
    function setActiveCategory(activeButton) {
      const categoryButtons = document.querySelectorAll('.category-btn');
      
      categoryButtons.forEach(button => {
        button.classList.remove('active');
        button.setAttribute('aria-selected', 'false');
      });
      
      activeButton.classList.add('active');
      activeButton.setAttribute('aria-selected', 'true');
    }
    
    function filterByCategory(category) {
      const cards = document.querySelectorAll('.product-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const cardCategory = card.dataset.category;
        const shouldShow = category === 'all' || cardCategory === category;
        
        card.style.display = shouldShow ? 'flex' : 'none';
        card.setAttribute('aria-hidden', !shouldShow);
        
        if (shouldShow) visibleCount++;
      });
      
      const categoryName = document.querySelector('[data-category="' + category + '"]').textContent;
      announceToScreenReader('已篩選' + categoryName + '，顯示 ' + visibleCount + ' 項商品');
    }
    
    // 📢 服務資訊切換
    function toggleServiceInfo() {
      const content = document.getElementById('service-content');
      const toggle = document.getElementById('service-toggle');
      const header = document.querySelector('.service-header');
      
      isServiceExpanded = !isServiceExpanded;
      
      if (isServiceExpanded) {
        content.style.display = 'grid';
        toggle.textContent = '▲';
        header.setAttribute('aria-expanded', 'true');
        content.setAttribute('aria-hidden', 'false');
      } else {
        content.style.display = 'none';
        toggle.textContent = '▼';
        header.setAttribute('aria-expanded', 'false');
        content.setAttribute('aria-hidden', 'true');
      }
      
      announceToScreenReader('服務資訊已' + (isServiceExpanded ? '展開' : '收合'));
    }
    
    // 🛍️ 商品相關功能
    function quickAddToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      if (product.is_priced_item) {
        showFeedback('計價商品請點擊詳情查看', 'warning');
        return;
      }
      
      addToCart(product, 1);
      showFeedback('已加入 ' + product.name + ' 到購物車', 'success');
      announceToScreenReader('已加入 ' + product.name + ' 到購物車');
    }
    
    function openProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const modal = document.getElementById('product-modal');
      const title = document.getElementById('product-modal-title');
      const body = document.getElementById('product-modal-body');
      
      title.textContent = product.name;
      
      body.innerHTML = `
        <div style="text-align: center; margin-bottom: var(--spacing-lg);">
          <div style="font-size: 4rem; margin-bottom: var(--spacing-md);" aria-hidden="true">
            ${product.image_url || '🥬'}
          </div>
          <h3 style="font-size: var(--font-size-xxl); font-weight: 600; margin-bottom: var(--spacing-sm);">
            ${product.name}
          </h3>
          
          <div style="background-color: var(--surface-color); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg);">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); text-align: left;">
              <div><strong>🌱 產地：</strong>台灣在地</div>
              <div><strong>📦 包裝：</strong>環保包材</div>
              <div><strong>🚚 配送：</strong>當日新鮮</div>
              <div><strong>❄️ 保存：</strong>冷藏保鮮</div>
            </div>
          </div>
          
          <div style="font-size: var(--font-size-xxl); font-weight: 700; color: var(--accent-color); margin-bottom: var(--spacing-lg);">
            ${product.is_priced_item ? '時價（依重量計算）' : '$' + product.price + ' / ' + (product.unit || '份')}
          </div>
          
          ${!product.is_priced_item ? `
            <div style="display: flex; align-items: center; justify-content: center; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);" role="group" aria-label="數量選擇">
              <button onclick="adjustQuantity(-1)" class="btn btn-secondary" aria-label="減少數量">−</button>
              <div style="font-size: var(--font-size-xl); font-weight: 700; min-width: 60px; text-align: center; 
                          padding: var(--spacing-sm); background-color: var(--surface-color); border-radius: 8px;"
                   id="quantity-display" aria-live="polite">1</div>
              <button onclick="adjustQuantity(1)" class="btn btn-secondary" aria-label="增加數量">+</button>
            </div>
            
            <button onclick="addToCartFromModal(${productId})" class="btn btn-primary btn-large" style="width: 100%;">
              加入購物車
            </button>
          ` : `
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
              此商品為計價商品，實際價格依重量計算，請聯絡客服詢價。
            </p>
            <button class="btn btn-secondary btn-large" style="width: 100%;" onclick="contactService()">
              聯絡客服詢價
            </button>
          `}
        </div>
      `;
      
      showModal(modal);
      announceToScreenReader('已開啟 ' + product.name + ' 詳細資訊');
    }
    
    let currentQuantity = 1;
    
    function adjustQuantity(change) {
      currentQuantity = Math.max(1, currentQuantity + change);
      document.getElementById('quantity-display').textContent = currentQuantity;
      announceToScreenReader('數量已調整為 ' + currentQuantity);
    }
    
    function addToCartFromModal(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      addToCart(product, currentQuantity);
      closeProductDetail();
      showFeedback('已加入 ' + currentQuantity + ' 個 ' + product.name + ' 到購物車', 'success');
      announceToScreenReader('已加入 ' + currentQuantity + ' 個 ' + product.name + ' 到購物車');
      
      currentQuantity = 1; // 重置
    }
    
    // 🛒 購物車功能
    function addToCart(product, quantity) {
      const existingItem = cart.find(item => item.id === product.id);
      
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: quantity,
          unit: product.unit || '份',
          is_priced_item: product.is_priced_item || false
        });
      }
      
      saveCart();
      updateCartDisplay();
    }
    
    function saveCart() {
      localStorage.setItem('universalCart', JSON.stringify(cart));
    }
    
    function updateCartDisplay() {
      const cartBar = document.getElementById('cart-bar');
      const totalElement = document.getElementById('cart-total');
      const countElement = document.getElementById('cart-count');
      const cartButton = document.getElementById('cart-button');
      
      let total = 0;
      let count = 0;
      
      cart.forEach(item => {
        if (!item.is_priced_item) {
          total += item.price * item.quantity;
        }
        count += item.quantity;
      });
      
      totalElement.textContent = total;
      countElement.textContent = count;
      
      // 更新購物車按鈕的無障礙標籤
      cartButton.setAttribute('aria-label', '開啟購物車，目前有 ' + count + ' 項商品，總計 ' + total + ' 元');
      
      if (count > 0) {
        cartBar.classList.add('visible');
      } else {
        cartBar.classList.remove('visible');
      }
    }
    
    function openCart() {
      const modal = document.getElementById('cart-modal');
      const body = document.getElementById('cart-modal-body');
      
      if (cart.length === 0) {
        body.innerHTML = `
          <div style="text-align: center; padding: var(--spacing-xxl) var(--spacing-lg);">
            <div style="font-size: 3rem; margin-bottom: var(--spacing-lg);" aria-hidden="true">🛒</div>
            <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">購物車是空的</h3>
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">快去選購新鮮蔬果吧！</p>
            <button onclick="closeCart()" class="btn btn-primary btn-large">繼續購物</button>
          </div>
        `;
      } else {
        renderCartContent(body);
      }
      
      showModal(modal);
      announceToScreenReader('已開啟購物車，共 ' + cart.length + ' 種商品');
    }
    
    function renderCartContent(container) {
      let subtotal = 0;
      
      const cartItemsHTML = cart.map((item, index) => {
        const itemTotal = item.is_priced_item ? 0 : item.price * item.quantity;
        subtotal += itemTotal;
        
        return `
          <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); 
                      background-color: var(--surface-color); border-radius: 8px; margin-bottom: var(--spacing-md);"
               role="listitem">
            
            <div style="flex: 1;">
              <h4 style="margin: 0 0 var(--spacing-xs) 0; font-weight: 600;">${item.name}</h4>
              <div style="font-size: var(--font-size-large); font-weight: 700; color: var(--accent-color);">
                ${item.is_priced_item ? '時價' : '$' + itemTotal}
              </div>
              <div style="font-size: var(--font-size-small); color: var(--text-secondary);">
                ${item.is_priced_item ? '依重量計算' : '$' + item.price + ' × ' + item.quantity + ' ' + item.unit}
              </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);" role="group" aria-label="${item.name} 數量控制">
              <button onclick="updateCartQuantity(${index}, -1)" 
                      class="btn btn-secondary" 
                      aria-label="減少 ${item.name} 數量"
                      ${item.quantity <= 1 ? 'disabled' : ''}>−</button>
              
              <span style="min-width: 30px; text-align: center; font-weight: 600;" aria-live="polite">${item.quantity}</span>
              
              <button onclick="updateCartQuantity(${index}, 1)" 
                      class="btn btn-secondary" 
                      aria-label="增加 ${item.name} 數量">+</button>
              
              <button onclick="removeFromCart(${index})" 
                      class="btn btn-secondary" 
                      aria-label="移除 ${item.name}"
                      style="color: var(--error-color); border-color: var(--error-color);">✕</button>
            </div>
          </div>
        `;
      }).join('');
      
      const deliveryFee = subtotal >= 200 ? 0 : 50;
      const total = subtotal + deliveryFee;
      
      container.innerHTML = `
        <div role="list" aria-label="購物車商品">
          ${cartItemsHTML}
        </div>
        
        <div style="border-top: 2px solid var(--border-color); padding-top: var(--spacing-lg); margin-top: var(--spacing-lg);">
          <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
            <span>商品小計：</span>
            <span style="font-weight: 600;">$${subtotal}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
            <span>外送費：</span>
            <span style="font-weight: 600; color: ${deliveryFee === 0 ? 'var(--success-color)' : 'var(--text-primary)'};">
              ${deliveryFee === 0 ? '免費 🎉' : '$' + deliveryFee}
            </span>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: var(--font-size-xl); font-weight: 700; 
                      color: var(--accent-color); border-top: 1px solid var(--border-color); padding-top: var(--spacing-sm);">
            <span>總計：</span>
            <span aria-live="polite">$${total}</span>
          </div>
        </div>
        
        ${subtotal < 200 ? `
          <div style="background-color: rgba(245, 124, 0, 0.1); border: 1px solid var(--warning-color); 
                      color: var(--warning-color); padding: var(--spacing-md); border-radius: 8px; 
                      margin: var(--spacing-lg) 0; text-align: center;" role="status">
            ⚠️ 還差 $${200 - subtotal} 即可享免費外送
          </div>
        ` : ''}
        
        <button onclick="proceedToCheckout()" class="btn btn-primary btn-large" style="width: 100%; margin-top: var(--spacing-lg);">
          前往結帳 ($${total})
        </button>
      `;
    }
    
    function updateCartQuantity(index, change) {
      if (cart[index]) {
        cart[index].quantity = Math.max(1, cart[index].quantity + change);
        saveCart();
        updateCartDisplay();
        
        // 重新渲染購物車內容
        const body = document.getElementById('cart-modal-body');
        renderCartContent(body);
        
        announceToScreenReader(cart[index].name + ' 數量已調整為 ' + cart[index].quantity);
      }
    }
    
    function removeFromCart(index) {
      if (cart[index] && confirm('確定要移除 ' + cart[index].name + ' 嗎？')) {
        const itemName = cart[index].name;
        cart.splice(index, 1);
        saveCart();
        updateCartDisplay();
        
        // 重新渲染購物車內容
        const body = document.getElementById('cart-modal-body');
        if (cart.length === 0) {
          closeCart();
          openCart(); // 重新開啟顯示空購物車
        } else {
          renderCartContent(body);
        }
        
        announceToScreenReader('已移除 ' + itemName);
        showFeedback('已移除 ' + itemName, 'success');
      }
    }
    
    function proceedToCheckout() {
      if (cart.length === 0) return;
      
      showFeedback('準備前往結帳...', 'success');
      setTimeout(() => {
        window.location.href = '/checkout';
      }, 1000);
    }
    
    // 🎭 彈窗管理
    function showModal(modal) {
      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      
      // 焦點管理
      const firstFocusableElement = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (firstFocusableElement) {
        setTimeout(() => firstFocusableElement.focus(), 100);
      }
    }
    
    function closeModal(modal) {
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
    }
    
    function closeAllModals() {
      const modals = document.querySelectorAll('.modal-overlay');
      modals.forEach(modal => closeModal(modal));
    }
    
    function closeProductDetail() {
      closeModal(document.getElementById('product-modal'));
    }
    
    function closeCart() {
      closeModal(document.getElementById('cart-modal'));
    }
    
    // 💬 用戶回饋系統
    function showFeedback(message, type = 'success') {
      const toast = document.getElementById('feedback-toast');
      
      toast.textContent = message;
      toast.className = 'feedback-toast show ' + type;
      
      setTimeout(() => {
        toast.className = 'feedback-toast';
      }, 3000);
    }
    
    // 🔊 螢幕閱讀器通知
    function announceToScreenReader(message) {
      const announcement = document.createElement('div');
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.className = 'sr-only';
      announcement.textContent = message;
      
      document.body.appendChild(announcement);
      
      setTimeout(() => {
        document.body.removeChild(announcement);
      }, 1000);
    }
    
    // 🔧 輔助功能
    function setupFocusManagement() {
      // 確保所有互動元素都可以被鍵盤訪問
      const interactiveElements = document.querySelectorAll('button, [role="button"], [tabindex]:not([tabindex="-1"])');
      
      interactiveElements.forEach(element => {
        if (!element.hasAttribute('tabindex')) {
          element.setAttribute('tabindex', '0');
        }
      });
    }
    
    function setupAriaStates() {
      // 設置初始 ARIA 狀態
      const expandableElements = document.querySelectorAll('[aria-expanded]');
      expandableElements.forEach(element => {
        if (!element.hasAttribute('aria-expanded')) {
          element.setAttribute('aria-expanded', 'false');
        }
      });
    }
    
    function manageFocusWithinModals(e) {
      const activeModal = document.querySelector('.modal-overlay.active');
      if (!activeModal) return;
      
      const focusableElements = activeModal.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      
      if (focusableElements.length === 0) return;
      
      const firstFocusable = focusableElements[0];
      const lastFocusable = focusableElements[focusableElements.length - 1];
      
      if (e.shiftKey) {
        if (document.activeElement === firstFocusable) {
          lastFocusable.focus();
          e.preventDefault();
        }
      } else {
        if (document.activeElement === lastFocusable) {
          firstFocusable.focus();
          e.preventDefault();
        }
      }
    }
    
    // 🎯 客服功能
    function contactService() {
      showFeedback('正在為您轉接客服...', 'success');
      // 這裡可以接入實際的客服系統
      setTimeout(() => {
        alert('客服電話：02-2345-6789\n或加入官方 LINE：@chengyi-veg');
      }, 1000);
    }
    
    // 點擊背景關閉彈窗
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        closeModal(e.target);
      }
    });
  </script>
</body>
</html>