<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚å–®è¿½è¹¤ - æ‰¿å„„è”¬èœå¤–é€</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .tracking-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .order-header {
            text-align: center;
            padding: 2rem 0;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .order-header h1 {
            color: #2e7d32;
            margin: 0 0 1rem 0;
        }

        .order-id {
            font-size: 1.5rem;
            color: #666;
            font-weight: bold;
        }

        .status-timeline {
            margin: 2rem 0;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 2rem;
            position: relative;
        }

        .timeline-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .timeline-icon.completed {
            background: #4caf50;
            color: white;
        }

        .timeline-icon.current {
            background: #ff9800;
            color: white;
            animation: pulse 2s infinite;
        }

        .timeline-icon.pending {
            background: #e0e0e0;
            color: #999;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .timeline-content {
            flex: 1;
            padding-top: 0.5rem;
        }

        .timeline-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .timeline-description {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .timeline-time {
            color: #999;
            font-size: 0.9rem;
        }

        .order-details {
            background: #f5f5f5;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: bold;
            color: #333;
        }

        .detail-value {
            color: #666;
        }

        .map-container {
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            margin: 2rem 0;
            position: relative;
        }

        .map-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #f5f5f5;
            color: #666;
        }

        .driver-info {
            background: #e3f2fd;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
            border-left: 4px solid #2196f3;
        }

        .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #2196f3;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .driver-details {
            display: flex;
            align-items: center;
        }

        .driver-text {
            flex: 1;
        }

        .driver-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .driver-contact {
            color: #666;
        }

        .estimated-time {
            text-align: center;
            padding: 1.5rem;
            background: #fff3e0;
            border-radius: 8px;
            margin: 2rem 0;
            border: 2px solid #ff9800;
        }

        .estimated-time h3 {
            color: #ef6c00;
            margin: 0 0 0.5rem 0;
        }

        .time-display {
            font-size: 2rem;
            font-weight: bold;
            color: #ef6c00;
        }

        .refresh-button {
            background: #2e7d32;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 1rem 0;
        }

        .refresh-button:hover {
            background: #1b5e20;
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }

        .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            overflow: hidden;
            transform: translateX(100%);
            animation: slideIn 0.3s ease-out forwards;
        }

        .notification.notification-fade-out {
            animation: slideOut 0.3s ease-in forwards;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        .notification-content {
            padding: 1rem;
            display: flex;
            align-items: flex-start;
        }

        .notification-icon {
            font-size: 1.5rem;
            margin-right: 0.8rem;
            flex-shrink: 0;
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .notification-message {
            color: #666;
            font-size: 0.9rem;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #999;
            margin-left: 0.5rem;
        }

        .notification-order {
            border-left: 4px solid #4caf50;
        }

        .notification-info {
            border-left: 4px solid #2196f3;
        }

        .notification-warning {
            border-left: 4px solid #ff9800;
        }

        .notification-error {
            border-left: 4px solid #f44336;
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .connection-status.connected {
            background: #4caf50;
            color: white;
        }

        .connection-status.disconnected {
            background: #f44336;
            color: white;
        }

        @media (max-width: 600px) {
            .tracking-container {
                margin: 1rem;
                padding: 0.8rem;
            }
            
            .timeline-item {
                margin-bottom: 1.5rem;
            }
            
            .timeline-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .map-container {
                height: 300px;
            }
            
            .notification-container {
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="tracking-container">
        <div class="order-header">
            <h1>è¨‚å–®è¿½è¹¤</h1>
            <div class="order-id">è¨‚å–®ç·¨è™Ÿ: #<span id="orderId"><%= order.id %></span></div>
            <button class="refresh-button" onclick="refreshOrderStatus()">ğŸ”„ åˆ·æ–°ç‹€æ…‹</button>
        </div>

        <!-- è¨‚å–®ç‹€æ…‹æ™‚é–“è»¸ -->
        <div class="status-timeline" id="statusTimeline">
            <!-- å‹•æ…‹ç”Ÿæˆæ™‚é–“è»¸é …ç›® -->
        </div>

        <!-- é è¨ˆé€é”æ™‚é–“ -->
        <div class="estimated-time" id="estimatedTimeSection" style="display: none;">
            <h3>ğŸ•’ é è¨ˆé€é”æ™‚é–“</h3>
            <div class="time-display" id="estimatedTime">--:--</div>
            <div id="countdown" style="margin-top: 1rem; color: #666;"></div>
        </div>

        <!-- å¤–é€å“¡è³‡è¨Š -->
        <div class="driver-info" id="driverInfo" style="display: none;">
            <h3>ğŸšš å¤–é€å“¡è³‡è¨Š</h3>
            <div class="driver-details">
                <div class="driver-avatar" id="driverAvatar">ğŸ‘¤</div>
                <div class="driver-text">
                    <div class="driver-name" id="driverName">Loading...</div>
                    <div class="driver-contact">
                        ğŸ“ <span id="driverPhone">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ°åœ– -->
        <div class="map-container" id="mapContainer">
            <div class="map-loading">
                ğŸ“ æ­£åœ¨è¼‰å…¥åœ°åœ–...
            </div>
        </div>

        <!-- è¨‚å–®è©³æƒ… -->
        <div class="order-details">
            <h3>ğŸ“‹ è¨‚å–®è©³æƒ…</h3>
            <div class="detail-row">
                <span class="detail-label">è¯çµ¡äºº:</span>
                <span class="detail-value"><%= order.contact_name %></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">é›»è©±:</span>
                <span class="detail-value"><%= order.contact_phone %></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">åœ°å€:</span>
                <span class="detail-value"><%= order.address %></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">è¨‚å–®é‡‘é¡:</span>
                <span class="detail-value">$<%= order.total %></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ä¸‹å–®æ™‚é–“:</span>
                <span class="detail-value"><%= new Date(order.created_at).toLocaleString() %></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ç›®å‰ç‹€æ…‹:</span>
                <span class="detail-value" data-order-status="<%= order.id %>">
                    <%= order.status %>
                </span>
            </div>
        </div>
    </div>

    <!-- é€£æ¥ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div class="connection-status disconnected" id="connectionStatus">
        ğŸ”´ æœªé€£æ¥
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„JavaScript -->
    <script src="/js/realtime-notifications.js"></script>
    <script>
        // è¨‚å–®è³‡æ–™
        const orderData = <%- JSON.stringify(order) %>;
        const orderId = orderData.id;
        
        // ç‹€æ…‹å°æ‡‰çš„åœ–ç¤ºå’Œæè¿°
        const statusConfig = {
            'placed': { icon: 'ğŸ“', title: 'è¨‚å–®æˆç«‹', description: 'æ‚¨çš„è¨‚å–®å·²æˆåŠŸå»ºç«‹' },
            'confirmed': { icon: 'âœ…', title: 'è¨‚å–®ç¢ºèª', description: 'æˆ‘å€‘å·²ç¢ºèªæ‚¨çš„è¨‚å–®' },
            'preparing': { icon: 'ğŸ‘¨â€ğŸ³', title: 'å•†å“æº–å‚™ä¸­', description: 'æ­£åœ¨ç‚ºæ‚¨æº–å‚™æ–°é®®å•†å“' },
            'ready': { icon: 'ğŸ“¦', title: 'å•†å“æº–å‚™å®Œæˆ', description: 'å•†å“å·²æº–å‚™å¥½ï¼Œç­‰å¾…å¤–é€å“¡å–è²¨' },
            'assigned': { icon: 'ğŸšš', title: 'å·²åˆ†é…å¤–é€å“¡', description: 'å¤–é€å“¡å·²æ¥å–®ï¼Œæº–å‚™å–è²¨' },
            'picked_up': { icon: 'ğŸƒâ€â™‚ï¸', title: 'å¤–é€å“¡å·²å–è²¨', description: 'å¤–é€å“¡å·²å–å¾—å•†å“ï¼Œæ­£åœ¨å‰å¾€æ‚¨çš„åœ°å€' },
            'delivering': { icon: 'ğŸ›µ', title: 'é…é€ä¸­', description: 'å¤–é€å“¡æ­£åœ¨è·¯ä¸Šï¼Œå³å°‡é€é”' },
            'delivered': { icon: 'ğŸ‰', title: 'å·²é€é”', description: 'å•†å“å·²æˆåŠŸé€é”ï¼Œæ„Ÿè¬æ‚¨çš„è¨‚è³¼' },
            'completed': { icon: 'âœ¨', title: 'è¨‚å–®å®Œæˆ', description: 'è¨‚å–®å·²å®Œæˆï¼Œæ­¡è¿å†æ¬¡è¨‚è³¼' },
            'cancelled': { icon: 'âŒ', title: 'è¨‚å–®å–æ¶ˆ', description: 'å¾ˆæŠ±æ­‰ï¼Œè¨‚å–®å·²è¢«å–æ¶ˆ' }
        };

        // è¨‚å–®ç‹€æ…‹é †åº
        const statusOrder = ['placed', 'confirmed', 'preparing', 'ready', 'assigned', 'picked_up', 'delivering', 'delivered', 'completed'];
        
        let orderTrackingMap = null;

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            initializeOrderTracking();
            loadGoogleMaps();
        });

        /**
         * åˆå§‹åŒ–è¨‚å–®è¿½è¹¤
         */
        function initializeOrderTracking() {
            // æ¸²æŸ“ç‹€æ…‹æ™‚é–“è»¸
            renderStatusTimeline();
            
            // ç›£è½å³æ™‚é€šçŸ¥äº‹ä»¶
            if (window.realtimeNotifications) {
                // è¨‚é–±è¨‚å–®æ›´æ–°
                window.realtimeNotifications.subscribeToOrder(orderId);
                
                // ç›£è½é€£æ¥ç‹€æ…‹è®ŠåŒ–
                window.realtimeNotifications.on('connected', updateConnectionStatus);
                window.realtimeNotifications.on('disconnected', updateConnectionStatus);
                
                // ç›£è½è¨‚å–®æ›´æ–°
                window.realtimeNotifications.on('orderUpdate', handleOrderUpdate);
                
                // ç›£è½å¤–é€å“¡ä½ç½®æ›´æ–°
                window.realtimeNotifications.on('driverLocation', handleDriverLocationUpdate);
            }

            // ç²å–æœ€æ–°è¨‚å–®ç‹€æ…‹
            refreshOrderStatus();
        }

        /**
         * æ¸²æŸ“ç‹€æ…‹æ™‚é–“è»¸
         */
        function renderStatusTimeline() {
            const timelineContainer = document.getElementById('statusTimeline');
            const currentStatus = orderData.status;
            const currentIndex = statusOrder.indexOf(currentStatus);
            
            let html = '';
            
            statusOrder.forEach((status, index) => {
                const config = statusConfig[status];
                let iconClass = 'pending';
                
                if (index < currentIndex) {
                    iconClass = 'completed';
                } else if (index === currentIndex) {
                    iconClass = 'current';
                }
                
                html += `
                    <div class="timeline-item">
                        <div class="timeline-icon ${iconClass}">
                            ${config.icon}
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">${config.title}</div>
                            <div class="timeline-description">${config.description}</div>
                            <div class="timeline-time" id="time-${status}"></div>
                        </div>
                    </div>
                `;
            });
            
            timelineContainer.innerHTML = html;
        }

        /**
         * è™•ç†è¨‚å–®æ›´æ–°
         */
        function handleOrderUpdate(data) {
            console.log('æ”¶åˆ°è¨‚å–®æ›´æ–°:', data);
            
            // æ›´æ–°æ™‚é–“è»¸
            renderStatusTimeline();
            
            // æ›´æ–°é è¨ˆé€é”æ™‚é–“
            if (data.estimatedDeliveryTime) {
                updateEstimatedDeliveryTime(data.estimatedDeliveryTime);
            }
            
            // æ›´æ–°å¤–é€å“¡è³‡è¨Š
            if (data.driverInfo) {
                updateDriverInfo(data.driverInfo);
                
                // è¨‚é–±å¤–é€å“¡ä½ç½®æ›´æ–°
                if (data.driverInfo.id) {
                    window.realtimeNotifications.subscribeToDriver(data.driverInfo.id);
                }
            }
        }

        /**
         * è™•ç†å¤–é€å“¡ä½ç½®æ›´æ–°
         */
        function handleDriverLocationUpdate(data) {
            console.log('æ”¶åˆ°å¤–é€å“¡ä½ç½®æ›´æ–°:', data);
            
            // æ›´æ–°åœ°åœ–ä¸Šçš„å¤–é€å“¡ä½ç½®
            if (orderTrackingMap && orderTrackingMap.updateDriverLocation) {
                orderTrackingMap.updateDriverLocation({
                    lat: data.lat,
                    lng: data.lng,
                    timestamp: data.timestamp
                });
            }
        }

        /**
         * æ›´æ–°é€£æ¥ç‹€æ…‹
         */
        function updateConnectionStatus(data) {
            const statusEl = document.getElementById('connectionStatus');
            if (window.realtimeNotifications && window.realtimeNotifications.isConnected) {
                statusEl.className = 'connection-status connected';
                statusEl.textContent = 'ğŸŸ¢ å³æ™‚é€£æ¥';
            } else {
                statusEl.className = 'connection-status disconnected';
                statusEl.textContent = 'ğŸ”´ é€£æ¥ä¸­æ–·';
            }
        }

        /**
         * æ›´æ–°é è¨ˆé€é”æ™‚é–“
         */
        function updateEstimatedDeliveryTime(deliveryTime) {
            const estimatedTimeSection = document.getElementById('estimatedTimeSection');
            const estimatedTimeEl = document.getElementById('estimatedTime');
            const countdownEl = document.getElementById('countdown');
            
            if (deliveryTime) {
                const deliveryDate = new Date(deliveryTime);
                estimatedTimeEl.textContent = deliveryDate.toLocaleTimeString();
                estimatedTimeSection.style.display = 'block';
                
                // é–‹å§‹å€’æ•¸è¨ˆæ™‚
                startCountdown(deliveryDate, countdownEl);
            }
        }

        /**
         * é–‹å§‹å€’æ•¸è¨ˆæ™‚
         */
        function startCountdown(targetDate, element) {
            const updateCountdown = () => {
                const now = new Date();
                const timeDiff = targetDate - now;
                
                if (timeDiff > 0) {
                    const minutes = Math.floor(timeDiff / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                    element.textContent = `é‚„æœ‰ ${minutes} åˆ† ${seconds} ç§’`;
                } else {
                    element.textContent = 'é è¨ˆé€é”æ™‚é–“å·²åˆ°';
                    clearInterval(countdownTimer);
                }
            };
            
            updateCountdown();
            const countdownTimer = setInterval(updateCountdown, 1000);
        }

        /**
         * æ›´æ–°å¤–é€å“¡è³‡è¨Š
         */
        function updateDriverInfo(driverInfo) {
            const driverInfoSection = document.getElementById('driverInfo');
            const driverNameEl = document.getElementById('driverName');
            const driverPhoneEl = document.getElementById('driverPhone');
            const driverAvatarEl = document.getElementById('driverAvatar');
            
            driverNameEl.textContent = driverInfo.name || 'æœªçŸ¥';
            driverPhoneEl.textContent = driverInfo.phone || '--';
            driverAvatarEl.textContent = driverInfo.name ? driverInfo.name.charAt(0) : 'ğŸ‘¤';
            
            driverInfoSection.style.display = 'block';
        }

        /**
         * åˆ·æ–°è¨‚å–®ç‹€æ…‹
         */
        async function refreshOrderStatus() {
            try {
                const response = await fetch(`/api/orders/${orderId}/status`);
                if (response.ok) {
                    const data = await response.json();
                    console.log('è¨‚å–®ç‹€æ…‹å·²æ›´æ–°:', data);
                    
                    // æ›´æ–°å…¨åŸŸè¨‚å–®è³‡æ–™
                    Object.assign(orderData, data);
                    
                    // é‡æ–°æ¸²æŸ“æ™‚é–“è»¸
                    renderStatusTimeline();
                    
                    // æ›´æ–°å…¶ä»–è³‡è¨Š
                    if (data.estimated_delivery_time) {
                        updateEstimatedDeliveryTime(data.estimated_delivery_time);
                    }
                    
                    if (data.driver) {
                        updateDriverInfo(data.driver);
                    }
                }
            } catch (error) {
                console.error('åˆ·æ–°è¨‚å–®ç‹€æ…‹å¤±æ•—:', error);
            }
        }

        /**
         * è¼‰å…¥ Google Maps
         */
        function loadGoogleMaps() {
            if (typeof google !== 'undefined') {
                initMap();
                return;
            }
            
            // å‹•æ…‹è¼‰å…¥ Google Maps API
            const script = document.createElement('script');
            script.src = 'https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap';
            script.async = true;
            document.head.appendChild(script);
        }

        /**
         * åˆå§‹åŒ–åœ°åœ–
         */
        function initMap() {
            const mapContainer = document.getElementById('mapContainer');
            
            // é è¨­å°ä¸­ä½ç½®
            const defaultLocation = { lat: 24.1477, lng: 120.6736 };
            
            // å¦‚æœè¨‚å–®æœ‰åº§æ¨™ï¼Œä½¿ç”¨è¨‚å–®åº§æ¨™
            let orderLocation = defaultLocation;
            if (orderData.lat && orderData.lng) {
                orderLocation = {
                    lat: parseFloat(orderData.lat),
                    lng: parseFloat(orderData.lng)
                };
            }
            
            const map = new google.maps.Map(mapContainer, {
                zoom: 14,
                center: orderLocation,
                styles: [
                    {
                        featureType: 'poi',
                        elementType: 'labels.icon',
                        stylers: [{ visibility: 'off' }]
                    }
                ]
            });
            
            // å»ºç«‹è¨‚å–®ä½ç½®æ¨™è¨˜
            const orderMarker = new google.maps.Marker({
                position: orderLocation,
                map: map,
                title: 'é€é”åœ°å€',
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#4CAF50" width="32px" height="32px">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(32, 32)
                }
            });
            
            // å»ºç«‹å¤–é€å“¡æ¨™è¨˜ (åˆå§‹éš±è—)
            const driverMarker = new google.maps.Marker({
                map: map,
                title: 'å¤–é€å“¡ä½ç½®',
                visible: false,
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF9800" width="32px" height="32px">
                            <path d="M19 15l-6 6-6-6h6V3h6v12z"/>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(32, 32)
                }
            });
            
            // å»ºç«‹è·¯ç·šé¡¯ç¤º
            const directionsRenderer = new google.maps.DirectionsRenderer({
                suppressMarkers: true,
                polylineOptions: {
                    strokeColor: '#FF9800',
                    strokeWeight: 4,
                    strokeOpacity: 0.8
                }
            });
            directionsRenderer.setMap(map);
            
            // å»ºç«‹åœ°åœ–æ§åˆ¶ç‰©ä»¶
            orderTrackingMap = {
                map: map,
                orderMarker: orderMarker,
                driverMarker: driverMarker,
                directionsRenderer: directionsRenderer,
                
                updateDriverLocation: function(locationData) {
                    const driverPosition = {
                        lat: locationData.lat,
                        lng: locationData.lng
                    };
                    
                    this.driverMarker.setPosition(driverPosition);
                    this.driverMarker.setVisible(true);
                    
                    // è¨ˆç®—ä¸¦é¡¯ç¤ºè·¯ç·š
                    this.calculateRoute(driverPosition, orderLocation);
                },
                
                calculateRoute: function(origin, destination) {
                    const directionsService = new google.maps.DirectionsService();
                    
                    directionsService.route({
                        origin: origin,
                        destination: destination,
                        travelMode: google.maps.TravelMode.DRIVING,
                        avoidHighways: false,
                        avoidTolls: false
                    }, (response, status) => {
                        if (status === 'OK') {
                            this.directionsRenderer.setDirections(response);
                            
                            // èª¿æ•´åœ°åœ–è¦–è§’ä»¥åŒ…å«å…©å€‹é»
                            const bounds = new google.maps.LatLngBounds();
                            bounds.extend(origin);
                            bounds.extend(destination);
                            this.map.fitBounds(bounds);
                        }
                    });
                }
            };
            
            // å°‡åœ°åœ–ç‰©ä»¶è¨­ç‚ºå…¨åŸŸè®Šæ•¸
            window.orderTrackingMap = orderTrackingMap;
            
            console.log('åœ°åœ–å·²åˆå§‹åŒ–');
        }
    </script>
</body>
</html>