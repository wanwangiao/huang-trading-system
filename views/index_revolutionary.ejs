<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>èª æ„é®®è”¬ 2.0 | é©å‘½æ€§è”¬æœè³¼ç‰©é«”é©— ğŸš€</title>
  
  <!-- PWA è¨­å®š -->
  <meta name="theme-color" content="#2d5a3d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/manifest.json">
  
  <!-- é è¼‰å…¥é—œéµè³‡æº -->
  <link rel="preload" href="/api/products" as="fetch" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style">
  
  <style>
    /* =================================================
       ğŸš€ SUB AGENTåœ˜éšŠ - é©å‘½æ€§è¨­è¨ˆç³»çµ±
       è®“è‡ªå·±éƒ½å¤§åƒä¸€é©šçš„è”¬æœè³¼ç‰©é«”é©—
       ================================================= */
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    :root {
      /* ğŸ¨ å…¨æ–°è‰²å½©ç³»çµ± - è‡ªç„¶æ¼¸è®Š */
      --primary-gradient: linear-gradient(135deg, #2d5a3d 0%, #1e3d2a 50%, #0f2318 100%);
      --accent-gradient: linear-gradient(135deg, #7cb342 0%, #8bc34a 50%, #9ccc65 100%);
      --surface-gradient: linear-gradient(135deg, #ffffff 0%, #f8fffe 50%, #f1f8f6 100%);
      --glass-effect: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      
      /* ğŸŒŸ å‹•æ…‹è‰²å½© */
      --success-glow: #4caf50;
      --warning-glow: #ff9800;
      --error-glow: #f44336;
      --info-glow: #2196f3;
      
      /* ğŸ“ ç²¾æº–é–“è·ç³»çµ± */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-xxl: 3rem;
      
      /* ğŸ¯ è§¸æ§å‹å¥½å°ºå¯¸ */
      --touch-min: 44px;
      --touch-comfortable: 56px;
      
      /* ğŸŒŠ æµæš¢å‹•ç•« */
      --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
      --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --ease-sharp: cubic-bezier(0.4, 0, 0.6, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: var(--surface-gradient);
      color: #1a1a1a;
      line-height: 1.6;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    /* =================================================
       ğŸŒŸ é©å‘½æ€§é ‚éƒ¨å°èˆª - å‹•æ…‹ç»ç’ƒæ•ˆæœ
       ================================================= */
    .revolutionary-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--glass-effect);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--glass-border);
      transition: all 0.3s var(--ease-smooth);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) var(--space-lg);
      max-width: 430px;
      margin: 0 auto;
      position: relative;
    }
    
    .brand-section {
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    .brand-logo {
      font-size: 1.8rem;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
      position: relative;
    }
    
    .brand-tagline {
      font-size: 0.75rem;
      font-weight: 500;
      color: rgba(45, 90, 61, 0.7);
      letter-spacing: 0.02em;
      margin-top: -0.2rem;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: var(--glass-effect);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s var(--ease-bounce);
      position: relative;
      overflow: hidden;
    }
    
    .action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--accent-gradient);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .action-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(124, 179, 66, 0.3);
    }
    
    .action-btn:hover::before {
      opacity: 1;
    }
    
    .action-btn:active {
      transform: scale(0.95);
    }
    
    /* =================================================
       ğŸ” æ™ºèƒ½æœå°‹ - AI é©…å‹•é«”é©—
       ================================================= */
    .smart-search-container {
      position: fixed;
      top: 80px;
      left: 0;
      right: 0;
      z-index: 999;
      padding: 0 var(--space-lg);
      max-width: 430px;
      margin: 0 auto;
    }
    
    .smart-search-wrapper {
      position: relative;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      border: 1px solid rgba(124, 179, 66, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: all 0.3s var(--ease-smooth);
    }
    
    .smart-search-wrapper.focused {
      transform: scale(1.02);
      box-shadow: 0 12px 40px rgba(124, 179, 66, 0.2);
      border-color: rgba(124, 179, 66, 0.4);
    }
    
    .smart-search-input {
      width: 100%;
      border: none;
      background: transparent;
      padding: var(--space-md) var(--space-lg);
      font-size: 1rem;
      font-weight: 500;
      color: #1a1a1a;
      outline: none;
      font-family: inherit;
    }
    
    .smart-search-input::placeholder {
      color: rgba(26, 26, 26, 0.5);
      font-weight: 400;
    }
    
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-radius: 0 0 15px 15px;
      border: 1px solid rgba(124, 179, 66, 0.2);
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s var(--ease-smooth);
    }
    
    .search-suggestions.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .suggestion-item {
      padding: var(--space-md) var(--space-lg);
      cursor: pointer;
      transition: background-color 0.2s ease;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-weight: 500;
    }
    
    .suggestion-item:hover {
      background: rgba(124, 179, 66, 0.1);
    }
    
    /* =================================================
       ğŸ·ï¸ å‹•æ…‹åˆ†é¡æ¨™ç±¤ - æµé«”å‹•ç•«
       ================================================= */
    .fluid-categories {
      position: fixed;
      top: 140px;
      left: 0;
      right: 0;
      z-index: 998;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .categories-container {
      display: flex;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-lg);
      max-width: 430px;
      margin: 0 auto;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    .categories-container::-webkit-scrollbar {
      display: none;
    }
    
    .category-pill {
      flex-shrink: 0;
      padding: var(--space-sm) var(--space-lg);
      border-radius: 20px;
      border: 2px solid transparent;
      background: rgba(124, 179, 66, 0.1);
      color: rgba(45, 90, 61, 0.8);
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s var(--ease-bounce);
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }
    
    .category-pill::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--accent-gradient);
      transition: left 0.4s var(--ease-smooth);
      z-index: -1;
    }
    
    .category-pill:hover::before,
    .category-pill.active::before {
      left: 0;
    }
    
    .category-pill:hover,
    .category-pill.active {
      color: white;
      transform: scale(1.05);
      border-color: rgba(124, 179, 66, 0.3);
      box-shadow: 0 4px 15px rgba(124, 179, 66, 0.3);
    }
    
    .category-pill:active {
      transform: scale(0.95);
    }
    
    /* =================================================
       ğŸƒ 3D å•†å“å¡ç‰‡ - è¦–å·®æ•ˆæœ
       ================================================= */
    .products-universe {
      padding-top: 200px;
      padding-bottom: 120px;
      min-height: 100vh;
      position: relative;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: var(--space-lg);
      padding: var(--space-xl) var(--space-lg);
      max-width: 430px;
      margin: 0 auto;
      perspective: 1000px;
    }
    
    .product-universe-card {
      background: var(--surface-gradient);
      border-radius: 20px;
      border: 1px solid rgba(124, 179, 66, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.4s var(--ease-smooth);
      position: relative;
      min-height: 280px;
      transform-style: preserve-3d;
      will-change: transform;
    }
    
    .product-universe-card:hover {
      transform: translateY(-8px) rotateX(5deg) rotateY(5deg);
      box-shadow: 0 20px 50px rgba(124, 179, 66, 0.2);
      border-color: rgba(124, 179, 66, 0.3);
    }
    
    .product-universe-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, 
        rgba(124, 179, 66, 0.1) 0%, 
        transparent 50%, 
        rgba(124, 179, 66, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .product-universe-card:hover::before {
      opacity: 1;
    }
    
    .card-image-sphere {
      height: 160px;
      background: linear-gradient(135deg, #f8fffe 0%, #e8f5e8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .card-image-sphere::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(124, 179, 66, 0.1) 0%, transparent 70%);
      animation: pulseGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes pulseGlow {
      0% { opacity: 0.3; transform: scale(0.8); }
      100% { opacity: 0.6; transform: scale(1.2); }
    }
    
    .product-emoji {
      font-size: 4rem;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
      transition: all 0.4s var(--ease-bounce);
      position: relative;
      z-index: 2;
    }
    
    .product-universe-card:hover .product-emoji {
      transform: scale(1.2) rotateY(15deg);
      filter: drop-shadow(0 8px 16px rgba(124, 179, 66, 0.3));
    }
    
    .card-content-matrix {
      padding: var(--space-lg);
      text-align: center;
      position: relative;
    }
    
    .product-name-glow {
      font-size: 1rem;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: var(--space-sm);
      line-height: 1.3;
      transition: all 0.3s ease;
    }
    
    .product-universe-card:hover .product-name-glow {
      color: #2d5a3d;
      text-shadow: 0 0 10px rgba(124, 179, 66, 0.3);
    }
    
    .price-quantum {
      font-size: 1.3rem;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--space-sm);
    }
    
    .unit-dimension {
      font-size: 0.8rem;
      color: rgba(26, 26, 26, 0.6);
      font-weight: 500;
    }
    
    /* =================================================
       ğŸ›’ é‡å­è³¼ç‰©è»Š - æ‡¸æµ®é­”æ³•
       ================================================= */
    .quantum-cart {
      position: fixed;
      bottom: var(--space-lg);
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      z-index: 1001;
      background: var(--primary-gradient);
      border-radius: 25px;
      padding: var(--space-lg) var(--space-xl);
      box-shadow: 0 10px 40px rgba(45, 90, 61, 0.4);
      backdrop-filter: blur(20px);
      transition: all 0.4s var(--ease-bounce);
      cursor: pointer;
      min-width: 280px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .quantum-cart.visible {
      transform: translateX(-50%) translateY(0);
    }
    
    .quantum-cart:hover {
      transform: translateX(-50%) translateY(-5px);
      box-shadow: 0 15px 50px rgba(45, 90, 61, 0.5);
    }
    
    .quantum-cart:active {
      transform: translateX(-50%) translateY(0) scale(0.98);
    }
    
    .cart-quantum-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }
    
    .cart-info-matrix {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }
    
    .cart-total-glow {
      font-size: 1.4rem;
      font-weight: 800;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    
    .cart-items-count {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 500;
    }
    
    .cart-portal-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      transition: all 0.3s var(--ease-bounce);
      backdrop-filter: blur(10px);
    }
    
    .cart-portal-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1) rotate(10deg);
    }
    
    /* =================================================
       ğŸ­ å…¨å±é«”é©—æ¨¡å¼
       ================================================= */
    .experience-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-lg);
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s var(--ease-smooth);
    }
    
    .experience-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-universe {
      background: var(--surface-gradient);
      border-radius: 30px;
      width: 100%;
      max-width: 400px;
      max-height: 90vh;
      overflow: hidden;
      transform: scale(0.8) translateY(50px);
      transition: transform 0.4s var(--ease-bounce);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(124, 179, 66, 0.2);
    }
    
    .experience-modal.active .modal-universe {
      transform: scale(1) translateY(0);
    }
    
    .modal-header-matrix {
      background: var(--primary-gradient);
      color: white;
      padding: var(--space-xl);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .modal-header-matrix::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: modalGlow 4s ease-in-out infinite;
    }
    
    @keyframes modalGlow {
      0%, 100% { opacity: 0.3; transform: scale(0.8) rotate(0deg); }
      50% { opacity: 0.6; transform: scale(1.2) rotate(180deg); }
    }
    
    .modal-title-glow {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: var(--space-sm);
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      position: relative;
      z-index: 2;
    }
    
    .modal-close-portal {
      position: absolute;
      top: var(--space-lg);
      right: var(--space-lg);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s var(--ease-bounce);
      backdrop-filter: blur(10px);
      z-index: 3;
    }
    
    .modal-close-portal:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1) rotate(90deg);
    }
    
    /* =================================================
       ğŸ¨ å¾®å‹•ç•«å’Œäº’å‹•æ•ˆæœ
       ================================================= */
    .float-effect {
      animation: floatEffect 3s ease-in-out infinite;
    }
    
    @keyframes floatEffect {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .pulse-effect {
      animation: pulseEffect 2s ease-in-out infinite;
    }
    
    @keyframes pulseEffect {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .shimmer-effect {
      background: linear-gradient(90deg, 
        rgba(255, 255, 255, 0) 0%, 
        rgba(255, 255, 255, 0.4) 50%, 
        rgba(255, 255, 255, 0) 100%);
      background-size: 200% 100%;
      animation: shimmerEffect 2s infinite;
    }
    
    @keyframes shimmerEffect {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    /* =================================================
       ğŸ“± éŸ¿æ‡‰å¼é­”æ³•
       ================================================= */
    @media (max-width: 400px) {
      .header-content {
        padding: var(--space-sm) var(--space-md);
      }
      
      .brand-logo {
        font-size: 1.6rem;
      }
      
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
        padding: var(--space-lg) var(--space-md);
      }
      
      .product-universe-card {
        min-height: 240px;
      }
      
      .card-image-sphere {
        height: 120px;
      }
      
      .product-emoji {
        font-size: 3rem;
      }
      
      .quantum-cart {
        left: var(--space-md);
        right: var(--space-md);
        transform: translateY(100px);
        min-width: auto;
      }
      
      .quantum-cart.visible {
        transform: translateY(0);
      }
      
      .quantum-cart:hover {
        transform: translateY(-5px);
      }
    }
    
    @media (min-width: 768px) {
      .header-content,
      .smart-search-container,
      .categories-container,
      .products-grid {
        max-width: 600px;
      }
      
      .products-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-xl);
      }
    }
    
    /* =================================================
       ğŸŒ™ æ·±è‰²æ¨¡å¼æ”¯æ´
       ================================================= */
    @media (prefers-color-scheme: dark) {
      :root {
        --surface-gradient: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
        --glass-effect: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
      }
      
      body {
        color: #ffffff;
      }
      
      .product-name-glow {
        color: #ffffff;
      }
      
      .brand-tagline {
        color: rgba(255, 255, 255, 0.7);
      }
    }
    
    /* =================================================
       â™¿ ç„¡éšœç¤™å„ªåŒ–
       ================================================= */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* é«˜å°æ¯”åº¦æ”¯æ´ */
    @media (prefers-contrast: high) {
      .product-universe-card {
        border: 2px solid #000;
      }
      
      .category-pill {
        border: 2px solid #000;
      }
    }
    
    /* Focus å¯è¦‹æ€§ */
    .action-btn:focus,
    .category-pill:focus,
    .product-universe-card:focus {
      outline: 3px solid #7cb342;
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <!-- ğŸš€ é©å‘½æ€§é ‚éƒ¨å°èˆª -->
  <header class="revolutionary-header float-effect">
    <div class="header-content">
      <div class="brand-section">
        <h1 class="brand-logo shimmer-effect">èª æ„é®®è”¬ 2.0</h1>
        <div class="brand-tagline">é©å‘½æ€§è”¬æœè³¼ç‰©é«”é©—</div>
      </div>
      
      <div class="header-actions">
        <button class="action-btn" onclick="openNotifications()" aria-label="é€šçŸ¥">
          ğŸ””
        </button>
        <button class="action-btn" onclick="openProfile()" aria-label="å€‹äººè³‡æ–™">
          ğŸ‘¤
        </button>
      </div>
    </div>
  </header>

  <!-- ğŸ” æ™ºèƒ½æœå°‹ -->
  <div class="smart-search-container">
    <div class="smart-search-wrapper">
      <input 
        type="text" 
        class="smart-search-input" 
        placeholder="ğŸ¤– AI æ™ºèƒ½æœå°‹è”¬æœ..."
        id="smart-search"
        autocomplete="off">
      
      <div class="search-suggestions" id="search-suggestions">
        <!-- å‹•æ…‹å»ºè­°å…§å®¹ -->
      </div>
    </div>
  </div>

  <!-- ğŸ·ï¸ å‹•æ…‹åˆ†é¡æ¨™ç±¤ -->
  <div class="fluid-categories">
    <div class="categories-container">
      <button class="category-pill active pulse-effect" data-category="all">ğŸŒŸ ç²¾é¸æ¨è–¦</button>
      <button class="category-pill" data-category="leafy">ğŸ¥¬ è‘‰èœé¡</button>
      <button class="category-pill" data-category="root">ğŸ¥• æ ¹è–é¡</button>
      <button class="category-pill" data-category="fruits">ğŸ æ–°é®®æ°´æœ</button>
      <button class="category-pill" data-category="herbs">ğŸŒ¿ é¦™è‰èª¿æ–™</button>
      <button class="category-pill" data-category="seasonal">â­ å­£ç¯€é™å®š</button>
    </div>
  </div>

  <!-- ğŸƒ å•†å“å®‡å®™ -->
  <main class="products-universe">
    <div class="products-grid" id="products-grid">
      <% if (products && products.length > 0) { %>
        <% products.forEach(function(product, index) { %>
          <div class="product-universe-card float-effect" 
               data-category="<%= product.is_priced_item ? 'proxy' : 'leafy' %>"
               onclick="openProductExperience(<%= product.id %>)"
               style="animation-delay: <%= index * 0.1 %>s">
            
            <div class="card-image-sphere">
              <div class="product-emoji">
                <%= product.image_url || getProductEmoji(product.name) %>
              </div>
            </div>
            
            <div class="card-content-matrix">
              <h3 class="product-name-glow"><%= product.name %></h3>
              
              <% if (product.is_priced_item) { %>
                <div class="price-quantum">æ™‚åƒ¹ âš¡</div>
                <div class="unit-dimension">ä¾é‡é‡è¨ˆç®—</div>
              <% } else { %>
                <div class="price-quantum">$<%= product.price %></div>
                <div class="unit-dimension">/ <%= product.unit || 'ä»½' %></div>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="empty-universe" style="grid-column: 1 / -1; text-align: center; padding: 4rem 2rem;">
          <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.6;">ğŸŒŒ</div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #2d5a3d;">å®‡å®™æ­£åœ¨è¼‰å…¥ä¸­...</h3>
          <p style="color: rgba(26, 26, 26, 0.6);">ç²¾å½©å•†å“å³å°‡åˆ°ä¾†</p>
        </div>
      <% } %>
    </div>
  </main>

  <!-- ğŸ›’ é‡å­è³¼ç‰©è»Š -->
  <div class="quantum-cart pulse-effect" id="quantum-cart" onclick="openCartExperience()">
    <div class="cart-quantum-display">
      <div class="cart-info-matrix">
        <div class="cart-total-glow">ç¸½è¨ˆ $<span id="cart-total">0</span></div>
        <div class="cart-items-count"><span id="cart-count">0</span> æ¨£å•†å“åœ¨å®‡å®™ä¸­</div>
      </div>
      
      <button class="cart-portal-btn">
        ğŸ›’
      </button>
    </div>
  </div>

  <!-- ğŸ­ ç”¢å“é«”é©—æ¨¡å¼ -->
  <div class="experience-modal" id="product-experience">
    <div class="modal-universe">
      <div class="modal-header-matrix">
        <h2 class="modal-title-glow" id="experience-title">ç”¢å“å®‡å®™</h2>
        <button class="modal-close-portal" onclick="closeProductExperience()">âœ•</button>
      </div>
      
      <div class="modal-content-matrix" id="experience-content">
        <!-- å‹•æ…‹å…§å®¹è¼‰å…¥ -->
      </div>
    </div>
  </div>

  <!-- ğŸ­ è³¼ç‰©è»Šé«”é©—æ¨¡å¼ -->
  <div class="experience-modal" id="cart-experience">
    <div class="modal-universe">
      <div class="modal-header-matrix">
        <h2 class="modal-title-glow">è³¼ç‰©å®‡å®™</h2>
        <button class="modal-close-portal" onclick="closeCartExperience()">âœ•</button>
      </div>
      
      <div class="modal-content-matrix" id="cart-content">
        <!-- è³¼ç‰©è»Šå…§å®¹ -->
      </div>
    </div>
  </div>

  <script>
    // ğŸš€ é©å‘½æ€§ JavaScript - è®“è‡ªå·±éƒ½é©šè‰·çš„äº’å‹•é«”é©—
    
    // å…¨åŸŸè®Šæ•¸
    const products = <%- JSON.stringify(products || []) %>;
    let cart = JSON.parse(localStorage.getItem('revolutionaryCart') || '[]');
    let currentProduct = null;
    
    // å•†å“è¡¨æƒ…ç¬¦è™Ÿæ˜ å°„ - æ›´è±å¯Œçš„è¦–è¦ºé«”é©—
    function getProductEmoji(name) {
      const emojiUniverse = {
        'é«˜éº—èœ': 'ğŸ¥¬', 'ç•ªèŒ„': 'ğŸ…', 'èƒ¡è˜¿è””': 'ğŸ¥•', 
        'å°é»ƒç“œ': 'ğŸ¥’', 'æ´‹è”¥': 'ğŸ§…', 'ç‰ç±³': 'ğŸŒ½',
        'é¦¬éˆ´è–¯': 'ğŸ¥”', 'é’æ±Ÿèœ': 'ğŸ¥¬', 'ç©ºå¿ƒèœ': 'ğŸ¥¬',
        'è èœ': 'ğŸ¥¬', 'éŸ­èœ': 'ğŸŒ¿', 'é’æ¤’': 'ğŸ«‘',
        'ç™½è˜¿è””': 'ğŸŒ¶ï¸', 'ç´…è˜¿è””': 'ğŸ¥•', 'èŒ„å­': 'ğŸ†'
      };
      
      for (let key in emojiUniverse) {
        if (name.includes(key)) {
          return emojiUniverse[key];
        }
      }
      return 'ğŸ¥¬';
    }
    
    // ğŸ¯ é é¢åˆå§‹åŒ– - å®‡å®™å•Ÿå‹•
    document.addEventListener('DOMContentLoaded', function() {
      initializeUniverse();
      updateQuantumCart();
      initializeSmartSearch();
      initializeFluidCategories();
      initializeParallaxEffects();
      initializeGestureControls();
    });
    
    // ğŸŒŒ å®‡å®™åˆå§‹åŒ–
    function initializeUniverse() {
      console.log('ğŸš€ å•Ÿå‹•é©å‘½æ€§è”¬æœè³¼ç‰©å®‡å®™...');
      
      // é è¼‰å…¥å‹•ç•«
      gsap.from('.product-universe-card', {
        y: 50,
        opacity: 0,
        duration: 0.6,
        stagger: 0.1,
        ease: "back.out(1.7)"
      });
      
      // æ™ºèƒ½é æ¸¬ç”¨æˆ¶å–œå¥½
      predictUserPreferences();
      
      // å•Ÿå‹•å¯¦æ™‚åº«å­˜ç›£æ§
      startInventoryMonitoring();
    }
    
    // ğŸ”® æ™ºèƒ½æœå°‹ç³»çµ±
    function initializeSmartSearch() {
      const searchInput = document.getElementById('smart-search');
      const suggestions = document.getElementById('search-suggestions');
      let searchTimeout;
      
      searchInput.addEventListener('focus', function() {
        this.parentElement.classList.add('focused');
        showAISuggestions();
      });
      
      searchInput.addEventListener('blur', function() {
        setTimeout(() => {
          this.parentElement.classList.remove('focused');
          suggestions.classList.remove('visible');
        }, 200);
      });
      
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performAISearch(this.value);
        }, 300);
      });
    }
    
    // ğŸ¤– AI é©…å‹•æœå°‹å»ºè­°
    function showAISuggestions() {
      const suggestions = document.getElementById('search-suggestions');
      const aiSuggestions = [
        'ğŸ”¥ ä»Šæ—¥ç‰¹åƒ¹è”¬èœ',
        'ğŸŒŸ ç‡Ÿé¤Šå¸«æ¨è–¦',
        'ğŸ¥— å¥åº·æ²™æ‹‰çµ„åˆ',
        'ğŸ² æ¹¯å“è”¬èœåŒ…',
        'ğŸŒˆ å½©è™¹è”¬æœç›¤'
      ];
      
      suggestions.innerHTML = aiSuggestions.map(suggestion => 
        `<div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">${suggestion}</div>`
      ).join('');
      
      suggestions.classList.add('visible');
    }
    
    // ğŸŒŠ æµé«”åˆ†é¡ç³»çµ±
    function initializeFluidCategories() {
      const categories = document.querySelectorAll('.category-pill');
      
      categories.forEach(category => {
        category.addEventListener('click', function() {
          categories.forEach(c => c.classList.remove('active'));
          this.classList.add('active');
          
          // æµé«”éæ¿¾å‹•ç•«
          filterProductsWithFluidAnimation(this.dataset.category);
        });
      });
    }
    
    // âœ¨ è¦–å·®æ•ˆæœç³»çµ±
    function initializeParallaxEffects() {
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const parallaxElements = document.querySelectorAll('.float-effect');
        
        parallaxElements.forEach((element, index) => {
          const speed = (index + 1) * 0.1;
          element.style.transform = `translateY(${scrolled * speed}px)`;
        });
      });
    }
    
    // ğŸ‘† æ‰‹å‹¢æ§åˆ¶ç³»çµ±
    function initializeGestureControls() {
      let startY = 0;
      let startX = 0;
      
      document.addEventListener('touchstart', (e) => {
        startY = e.touches[0].clientY;
        startX = e.touches[0].clientX;
      });
      
      document.addEventListener('touchend', (e) => {
        const endY = e.changedTouches[0].clientY;
        const endX = e.changedTouches[0].clientX;
        const diffY = startY - endY;
        const diffX = startX - endX;
        
        // ä¸Šæ»‘é–‹å•Ÿè³¼ç‰©è»Š
        if (diffY > 100 && Math.abs(diffX) < 100) {
          openCartExperience();
        }
        
        // ä¸‹æ»‘é‡æ–°æ•´ç†
        if (diffY < -150 && window.scrollY === 0) {
          location.reload();
        }
      });
    }
    
    // ğŸ­ é–‹å•Ÿç”¢å“é«”é©—
    function openProductExperience(productId) {
      currentProduct = products.find(p => p.id === productId);
      if (!currentProduct) return;
      
      const modal = document.getElementById('product-experience');
      const title = document.getElementById('experience-title');
      const content = document.getElementById('experience-content');
      
      title.textContent = currentProduct.name;
      
      // å‰µé€ æ²‰æµ¸å¼ç”¢å“é«”é©—
      content.innerHTML = `
        <div style="padding: 2rem; text-align: center;">
          <div style="font-size: 6rem; margin-bottom: 1rem; animation: float 2s ease-in-out infinite;">
            ${currentProduct.image_url || getProductEmoji(currentProduct.name)}
          </div>
          
          <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #2d5a3d;">
            ${currentProduct.name}
          </h3>
          
          <div style="background: linear-gradient(135deg, rgba(124, 179, 66, 0.1), rgba(124, 179, 66, 0.05)); 
                      padding: 1rem; border-radius: 15px; margin-bottom: 1.5rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: left;">
              <div><strong>ğŸŒ± ç”¢åœ°:</strong> å°ç£åœ¨åœ°</div>
              <div><strong>ğŸ“¦ åŒ…è£:</strong> ç’°ä¿åŒ…æ</div>
              <div><strong>ğŸšš é…é€:</strong> ç•¶æ—¥æ–°é®®</div>
              <div><strong>â„ï¸ ä¿å­˜:</strong> å†·è—ä¿é®®</div>
            </div>
          </div>
          
          <div style="font-size: 2rem; font-weight: 800; 
                      background: linear-gradient(135deg, #7cb342, #8bc34a); 
                      -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
                      margin-bottom: 1.5rem;">
            ${currentProduct.is_priced_item ? 'æ™‚åƒ¹ âš¡' : '$' + currentProduct.price}
          </div>
          
          <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">
            <button onclick="adjustQuantity(-1)" style="width: 50px; height: 50px; border-radius: 50%; 
                    background: linear-gradient(135deg, #7cb342, #8bc34a); color: white; border: none; 
                    font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">âˆ’</button>
            
            <div id="quantity-universe" style="font-size: 1.5rem; font-weight: 700; 
                 min-width: 60px; text-align: center; padding: 0.5rem; 
                 background: rgba(124, 179, 66, 0.1); border-radius: 10px;">1</div>
            
            <button onclick="adjustQuantity(1)" style="width: 50px; height: 50px; border-radius: 50%; 
                    background: linear-gradient(135deg, #7cb342, #8bc34a); color: white; border: none; 
                    font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">+</button>
          </div>
          
          <button onclick="addToQuantumCart()" style="width: 100%; padding: 1rem; 
                  background: linear-gradient(135deg, #2d5a3d, #1e3d2a); color: white; 
                  border: none; border-radius: 15px; font-size: 1.2rem; font-weight: 700; 
                  cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
            <span style="position: relative; z-index: 2;">ğŸš€ åŠ å…¥å®‡å®™è³¼ç‰©è»Š</span>
          </button>
        </div>
      `;
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // ğŸ›’ é–‹å•Ÿè³¼ç‰©è»Šé«”é©—
    function openCartExperience() {
      const modal = document.getElementById('cart-experience');
      const content = document.getElementById('cart-content');
      
      if (cart.length === 0) {
        content.innerHTML = `
          <div style="padding: 3rem 2rem; text-align: center;">
            <div style="font-size: 5rem; margin-bottom: 1rem; opacity: 0.6;">ğŸŒŒ</div>
            <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">è³¼ç‰©å®‡å®™æ˜¯ç©ºçš„</h3>
            <p style="color: rgba(26, 26, 26, 0.6); margin-bottom: 2rem;">é–‹å§‹æ¢ç´¢æ–°é®®è”¬æœå§ï¼</p>
            <button onclick="closeCartExperience()" style="padding: 1rem 2rem; 
                    background: linear-gradient(135deg, #7cb342, #8bc34a); color: white; 
                    border: none; border-radius: 25px; font-weight: 600; cursor: pointer;">
              ç¹¼çºŒæ¢ç´¢ ğŸš€
            </button>
          </div>
        `;
      } else {
        renderQuantumCartContent(content);
      }
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // ğŸŒŒ æ¸²æŸ“é‡å­è³¼ç‰©è»Šå…§å®¹
    function renderQuantumCartContent(container) {
      let total = 0;
      
      const cartHTML = cart.map(item => {
        if (!item.is_priced_item) {
          total += item.price * item.quantity;
        }
        
        return `
          <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; 
                      background: rgba(124, 179, 66, 0.05); border-radius: 15px; margin-bottom: 1rem;">
            <div style="font-size: 2.5rem; flex-shrink: 0;">
              ${item.image || getProductEmoji(item.name)}
            </div>
            
            <div style="flex: 1;">
              <h4 style="margin: 0 0 0.3rem 0; font-weight: 600;">${item.name}</h4>
              <div style="font-size: 1.1rem; font-weight: 700; color: #7cb342;">
                $${item.is_priced_item ? 'æ™‚åƒ¹' : item.price * item.quantity}
              </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <button onclick="updateQuantumQuantity(${item.id}, -1)" 
                      style="width: 32px; height: 32px; border-radius: 50%; 
                             background: #f0f0f0; border: none; cursor: pointer;">âˆ’</button>
              <span style="min-width: 30px; text-align: center; font-weight: 600;">${item.quantity}</span>
              <button onclick="updateQuantumQuantity(${item.id}, 1)" 
                      style="width: 32px; height: 32px; border-radius: 50%; 
                             background: #f0f0f0; border: none; cursor: pointer;">+</button>
            </div>
          </div>
        `;
      }).join('');
      
      const deliveryFee = total >= 200 ? 0 : 50;
      const finalTotal = total + deliveryFee;
      
      container.innerHTML = `
        <div style="padding: 2rem;">
          ${cartHTML}
          
          <div style="border-top: 2px solid rgba(124, 179, 66, 0.2); padding-top: 1rem; margin-top: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
              <span>å•†å“å°è¨ˆ:</span>
              <span style="font-weight: 600;">$${total}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
              <span>å¤–é€è²»:</span>
              <span style="font-weight: 600; color: ${deliveryFee === 0 ? '#4caf50' : '#666'};">
                ${deliveryFee === 0 ? 'å…è²» ğŸ‰' : '$' + deliveryFee}
              </span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; 
                        color: #2d5a3d; border-top: 1px solid rgba(124, 179, 66, 0.2); padding-top: 0.5rem;">
              <span>ç¸½è¨ˆ:</span>
              <span>$${finalTotal}</span>
            </div>
          </div>
          
          ${total < 200 ? `
            <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); 
                        color: #f57f17; padding: 1rem; border-radius: 10px; margin: 1rem 0; text-align: center;">
              âš ï¸ é‚„å·® $${200 - total} å³å¯äº«å…è²»å¤–é€
            </div>
          ` : ''}
          
          <button onclick="proceedToQuantumCheckout()" 
                  style="width: 100%; padding: 1.2rem; margin-top: 1rem;
                         background: linear-gradient(135deg, #2d5a3d, #1e3d2a); color: white; 
                         border: none; border-radius: 15px; font-size: 1.2rem; font-weight: 700; 
                         cursor: pointer; position: relative; overflow: hidden;">
            ğŸš€ å‰å¾€é‡å­çµå¸³
          </button>
        </div>
      `;
    }
    
    // ğŸ”§ å·¥å…·å‡½æ•¸
    let currentQuantity = 1;
    
    function adjustQuantity(change) {
      currentQuantity = Math.max(1, currentQuantity + change);
      document.getElementById('quantity-universe').textContent = currentQuantity;
    }
    
    function addToQuantumCart() {
      if (!currentProduct) return;
      
      const existingItem = cart.find(item => item.id === currentProduct.id);
      
      if (existingItem) {
        existingItem.quantity += currentQuantity;
      } else {
        cart.push({
          id: currentProduct.id,
          name: currentProduct.name,
          price: currentProduct.price,
          quantity: currentQuantity,
          image: currentProduct.image_url || getProductEmoji(currentProduct.name),
          is_priced_item: currentProduct.is_priced_item || false
        });
      }
      
      localStorage.setItem('revolutionaryCart', JSON.stringify(cart));
      updateQuantumCart();
      
      // æˆåŠŸå‹•ç•«
      showQuantumFeedback('ğŸ‰ å·²åŠ å…¥è³¼ç‰©å®‡å®™ï¼');
      setTimeout(() => closeProductExperience(), 1500);
    }
    
    function updateQuantumCart() {
      const cartElement = document.getElementById('quantum-cart');
      const totalElement = document.getElementById('cart-total');
      const countElement = document.getElementById('cart-count');
      
      let total = 0;
      let count = 0;
      
      cart.forEach(item => {
        if (!item.is_priced_item) {
          total += item.price * item.quantity;
        }
        count += item.quantity;
      });
      
      totalElement.textContent = total;
      countElement.textContent = count;
      
      if (count > 0) {
        cartElement.classList.add('visible');
      } else {
        cartElement.classList.remove('visible');
      }
    }
    
    function updateQuantumQuantity(productId, change) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity = Math.max(1, item.quantity + change);
        localStorage.setItem('revolutionaryCart', JSON.stringify(cart));
        updateQuantumCart();
        
        // é‡æ–°æ¸²æŸ“è³¼ç‰©è»Š
        const content = document.getElementById('cart-content');
        renderQuantumCartContent(content);
      }
    }
    
    function showQuantumFeedback(message) {
      const feedback = document.createElement('div');
      feedback.textContent = message;
      feedback.style.cssText = `
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #2d5a3d, #1e3d2a); color: white;
        padding: 1rem 2rem; border-radius: 25px; font-weight: 600;
        z-index: 3000; animation: quantumPulse 1.5s ease;
      `;
      
      document.body.appendChild(feedback);
      setTimeout(() => feedback.remove(), 1500);
    }
    
    // ğŸ­ é—œé–‰å½ˆçª—
    function closeProductExperience() {
      const modal = document.getElementById('product-experience');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    
    function closeCartExperience() {
      const modal = document.getElementById('cart-experience');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    
    // ğŸ”® AI é©…å‹•åŠŸèƒ½ (é ç•™æ“´å±•)
    function predictUserPreferences() {
      console.log('ğŸ¤– AI æ­£åœ¨å­¸ç¿’æ‚¨çš„å–œå¥½...');
    }
    
    function startInventoryMonitoring() {
      console.log('ğŸ“Š å•Ÿå‹•å¯¦æ™‚åº«å­˜ç›£æ§ç³»çµ±...');
    }
    
    function performAISearch(query) {
      console.log('ğŸ” AI æœå°‹:', query);
    }
    
    function selectSuggestion(suggestion) {
      document.getElementById('smart-search').value = suggestion;
      document.getElementById('search-suggestions').classList.remove('visible');
    }
    
    function filterProductsWithFluidAnimation(category) {
      const cards = document.querySelectorAll('.product-universe-card');
      
      cards.forEach((card, index) => {
        const cardCategory = card.dataset.category;
        const shouldShow = category === 'all' || cardCategory === category;
        
        if (shouldShow) {
          card.style.display = 'block';
          gsap.from(card, {
            scale: 0.8,
            opacity: 0,
            duration: 0.4,
            delay: index * 0.05,
            ease: "back.out(1.7)"
          });
        } else {
          gsap.to(card, {
            scale: 0.8,
            opacity: 0,
            duration: 0.3,
            onComplete: () => card.style.display = 'none'
          });
        }
      });
    }
    
    function proceedToQuantumCheckout() {
      showQuantumFeedback('ğŸš€ æº–å‚™é€²å…¥é‡å­çµå¸³...');
      setTimeout(() => {
        window.location.href = '/checkout';
      }, 2000);
    }
    
    // ğŸ¨ å‹•æ…‹æ¨£å¼æ³¨å…¥
    const dynamicStyles = document.createElement('style');
    dynamicStyles.textContent = `
      @keyframes quantumPulse {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
    `;
    document.head.appendChild(dynamicStyles);
    
    // ğŸ§ éŸ³æ•ˆç³»çµ± (å¯é¸)
    function playQuantumSound(type) {
      // å¯ä»¥åŠ å…¥éŸ³æ•ˆå¢å¼·é«”é©—
    }
    
    // é ç•™çµ¦ GSAP å‹•ç•«åº«çš„ç©ºé–“
    // å¦‚æœæœ‰è¼‰å…¥ GSAPï¼Œæœƒè‡ªå‹•å•Ÿç”¨æ›´é«˜ç´šçš„å‹•ç•«æ•ˆæœ
  </script>
</body>
</html>