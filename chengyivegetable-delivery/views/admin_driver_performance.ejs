<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–é€å“¡ç¸¾æ•ˆçµ±è¨ˆ - èª æ†¶é®®è”¬ç®¡ç†å¾Œå°</title>
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .performance-container {
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .performance-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .control-group select, .control-group input {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .performance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .performance-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .card-header {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .card-content {
            padding: 20px;
        }
        
        .drivers-ranking {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .ranking-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .ranking-content {
            padding: 0;
        }
        
        .driver-row {
            display: grid;
            grid-template-columns: 50px 200px 1fr 1fr 1fr 1fr 1fr 100px;
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .driver-row:hover {
            background: #f8f9fa;
        }
        
        .driver-row.header {
            background: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .rank-badge {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        
        .rank-1 { background: #f1c40f; }
        .rank-2 { background: #95a5a6; }
        .rank-3 { background: #e67e22; }
        .rank-other { background: #7f8c8d; }
        
        .driver-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .driver-info {
            display: flex;
            align-items: center;
        }
        
        .driver-name {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .driver-details {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 2px;
        }
        
        .performance-metric {
            text-align: center;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-change {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            margin-top: 2px;
            display: inline-block;
        }
        
        .metric-change.positive {
            background: #d4edda;
            color: #155724;
        }
        
        .metric-change.negative {
            background: #f8d7da;
            color: #721c24;
        }
        
        .metric-change.neutral {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
        }
        
        .status-online { background: #d4edda; color: #155724; }
        .status-busy { background: #fff3cd; color: #856404; }
        .status-offline { background: #f8d7da; color: #721c24; }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .performance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-left: 4px solid var(--accent-color, #3498db);
        }
        
        .summary-card.deliveries { --accent-color: #27ae60; }
        .summary-card.efficiency { --accent-color: #3498db; }
        .summary-card.satisfaction { --accent-color: #f39c12; }
        .summary-card.earnings { --accent-color: #e74c3c; }
        
        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent-color);
            margin: 10px 0;
        }
        
        .summary-change {
            font-size: 0.9em;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .driver-details-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            display: none;
        }
        
        .details-header {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .details-content {
            padding: 20px;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .detail-item {
            display: flex;
            justify-content: between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .detail-label {
            color: #7f8c8d;
        }
        
        .detail-value {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .rating-stars {
            color: #f1c40f;
            font-size: 16px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .breadcrumb {
            margin-bottom: 20px;
            color: #7f8c8d;
        }
        
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }
        
        .filter-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        @media (max-width: 1200px) {
            .performance-grid {
                grid-template-columns: 1fr;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .driver-row {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 10px;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e9ecef;
            border-left: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="performance-container">
        <!-- éºµåŒ…å±‘å°èˆª -->
        <div class="breadcrumb">
            <a href="/admin/dashboard">ç®¡ç†å¾Œå°</a> > <span>å¤–é€å“¡ç¸¾æ•ˆçµ±è¨ˆ</span>
        </div>
        
        <!-- ç¸¾æ•ˆçµ±è¨ˆæ¨™é¡Œ -->
        <div class="performance-header">
            <div>
                <h1>ğŸšš å¤–é€å“¡ç¸¾æ•ˆçµ±è¨ˆ</h1>
                <p>è¿½è¹¤å¤–é€å“¡è¡¨ç¾ï¼Œæå‡æœå‹™å“è³ª</p>
            </div>
            <div class="header-controls">
                <div class="control-group">
                    <label>æ™‚é–“ç¯„åœ</label>
                    <select id="timeRange">
                        <option value="7">è¿‘7å¤©</option>
                        <option value="30" selected>è¿‘30å¤©</option>
                        <option value="90">è¿‘3å€‹æœˆ</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>å¤–é€å“¡</label>
                    <select id="driverFilter">
                        <option value="all">æ‰€æœ‰å¤–é€å“¡</option>
                        <option value="1">æå¤§æ˜</option>
                        <option value="2">ç‹å°è¯</option>
                        <option value="3">å¼µå¿—å‰</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="refreshData()">ğŸ”„ æ›´æ–°</button>
            </div>
        </div>
        
        <!-- ç¸¾æ•ˆæ‘˜è¦ -->
        <div class="performance-summary">
            <div class="summary-card deliveries">
                <h3>ğŸ“¦ ç¸½é…é€æ•¸</h3>
                <div class="summary-value" id="totalDeliveries">230</div>
                <div class="summary-change positive" id="deliveriesChange">+15.2% è¼ƒä¸ŠæœŸ</div>
            </div>
            <div class="summary-card efficiency">
                <h3>âš¡ å¹³å‡æ•ˆç‡</h3>
                <div class="summary-value" id="avgEfficiency">94.2%</div>
                <div class="summary-change positive" id="efficiencyChange">+3.1% è¼ƒä¸ŠæœŸ</div>
            </div>
            <div class="summary-card satisfaction">
                <h3>ğŸ˜Š å®¢æˆ¶æ»¿æ„åº¦</h3>
                <div class="summary-value" id="avgSatisfaction">4.8</div>
                <div class="summary-change positive" id="satisfactionChange">+0.2 è¼ƒä¸ŠæœŸ</div>
            </div>
            <div class="summary-card earnings">
                <h3>ğŸ’° å¹³å‡æ”¶å…¥</h3>
                <div class="summary-value" id="avgEarnings">$2,850</div>
                <div class="summary-change neutral" id="earningsChange">+2.3% è¼ƒä¸ŠæœŸ</div>
            </div>
        </div>
        
        <!-- ç¸¾æ•ˆåœ–è¡¨ -->
        <div class="performance-grid">
            <div class="performance-card">
                <div class="card-header">
                    <h3>ğŸ“Š é…é€æ•ˆç‡è¶¨å‹¢</h3>
                    <button class="btn btn-success" onclick="exportChart('efficiency')">ğŸ“Š åŒ¯å‡º</button>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="performance-card">
                <div class="card-header">
                    <h3>â° é…é€æ™‚é–“åˆ†å¸ƒ</h3>
                    <button class="btn btn-success" onclick="exportChart('timeDistribution')">ğŸ“Š åŒ¯å‡º</button>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="timeDistributionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="performance-card">
                <div class="card-header">
                    <h3>ğŸ¯ ç¸¾æ•ˆè©•åˆ†</h3>
                    <button class="btn btn-success" onclick="exportChart('performance')">ğŸ“Š åŒ¯å‡º</button>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="performanceRadarChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="performance-card">
                <div class="card-header">
                    <h3>ğŸ’° æ”¶å…¥åˆ†æ</h3>
                    <button class="btn btn-success" onclick="exportChart('earnings')">ğŸ“Š åŒ¯å‡º</button>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="earningsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å¤–é€å“¡æ’å -->
        <div class="drivers-ranking">
            <div class="ranking-header">
                <div>
                    <h3>ğŸ† å¤–é€å“¡æ’åæ¦œ</h3>
                    <p>æ ¹æ“šç¶œåˆç¸¾æ•ˆè©•åˆ†æ’åº</p>
                </div>
                <div>
                    <button class="btn btn-success" onclick="exportTable()">ğŸ“„ åŒ¯å‡ºExcel</button>
                </div>
            </div>
            <div class="ranking-content">
                <div class="driver-row header">
                    <div>æ’å</div>
                    <div>å¤–é€å“¡</div>
                    <div>é…é€æ•¸</div>
                    <div>æº–æ™‚ç‡</div>
                    <div>å¹³å‡æ™‚é–“</div>
                    <div>å®¢æˆ¶è©•åƒ¹</div>
                    <div>æœ¬æœˆæ”¶å…¥</div>
                    <div>ç‹€æ…‹</div>
                </div>
                <div id="driverRankingList">
                    <!-- å‹•æ…‹è¼‰å…¥å¤–é€å“¡æ’å -->
                </div>
            </div>
        </div>
        
        <!-- å¤–é€å“¡è©³æƒ…é¢æ¿ -->
        <div class="driver-details-panel" id="driverDetailsPanel">
            <div class="details-header">
                <h3 id="selectedDriverName">å¤–é€å“¡è©³æƒ…</h3>
                <button class="btn btn-danger" onclick="closeDriverDetails()">âœ• é—œé–‰</button>
            </div>
            <div class="details-content">
                <div class="details-grid">
                    <div class="detail-section">
                        <div class="section-title">ğŸ“Š ç¸¾æ•ˆçµ±è¨ˆ</div>
                        <div class="detail-item">
                            <span class="detail-label">ç¸½é…é€æ•¸:</span>
                            <span class="detail-value" id="detailTotalDeliveries">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æˆåŠŸç‡:</span>
                            <span class="detail-value" id="detailSuccessRate">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å¹³å‡é…é€æ™‚é–“:</span>
                            <span class="detail-value" id="detailAvgTime">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æº–æ™‚é…é€ç‡:</span>
                            <span class="detail-value" id="detailOnTimeRate">--</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">ğŸ˜Š å®¢æˆ¶åé¥‹</div>
                        <div class="detail-item">
                            <span class="detail-label">å¹³å‡è©•åˆ†:</span>
                            <span class="detail-value" id="detailAvgRating">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">äº”æ˜Ÿè©•åƒ¹:</span>
                            <span class="detail-value" id="detailFiveStars">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å®¢æˆ¶æŠ•è¨´:</span>
                            <span class="detail-value" id="detailComplaints">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å®¢æˆ¶ç¨±è®š:</span>
                            <span class="detail-value" id="detailPraises">--</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">ğŸ’° æ”¶å…¥è³‡è¨Š</div>
                        <div class="detail-item">
                            <span class="detail-label">æœ¬æœˆæ”¶å…¥:</span>
                            <span class="detail-value" id="detailMonthlyEarnings">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å¹³å‡æ¯å–®:</span>
                            <span class="detail-value" id="detailAvgEarnings">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">çé‡‘:</span>
                            <span class="detail-value" id="detailBonus">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æ’åçå‹µ:</span>
                            <span class="detail-value" id="detailRankBonus">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è¼‰å…¥é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>è¼‰å…¥ç¸¾æ•ˆè³‡æ–™ä¸­...</p>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let performanceCharts = {};
        let driverData = [];
        let currentSelectedDriver = null;
        
        // ç¤ºç¯„è³‡æ–™
        const sampleDriverData = [
            {
                id: 1,
                name: 'æå¤§æ˜',
                phone: '0912345678',
                vehicle: 'æ©Ÿè»Š',
                status: 'online',
                deliveries: 89,
                onTimeRate: 96.6,
                avgTime: 38,
                rating: 4.9,
                monthlyEarnings: 3200,
                efficiency: 96.6,
                successRate: 98.9,
                complaints: 0,
                praises: 15,
                bonus: 500
            },
            {
                id: 2,
                name: 'ç‹å°è¯',
                phone: '0923456789',
                vehicle: 'æ©Ÿè»Š',
                status: 'busy',
                deliveries: 76,
                onTimeRate: 94.7,
                avgTime: 41,
                rating: 4.7,
                monthlyEarnings: 2850,
                efficiency: 94.7,
                successRate: 97.4,
                complaints: 1,
                praises: 12,
                bonus: 300
            },
            {
                id: 3,
                name: 'å¼µå¿—å‰',
                phone: '0934567890',
                vehicle: 'è…³è¸è»Š',
                status: 'offline',
                deliveries: 65,
                onTimeRate: 92.3,
                avgTime: 45,
                rating: 4.6,
                monthlyEarnings: 2400,
                efficiency: 92.3,
                successRate: 95.4,
                complaints: 2,
                praises: 8,
                bonus: 200
            }
        ];
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadDriverRanking();
            updatePerformanceSummary();
        });
        
        // åˆå§‹åŒ–æ‰€æœ‰åœ–è¡¨
        function initializeCharts() {
            // é…é€æ•ˆç‡è¶¨å‹¢åœ–
            const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
            performanceCharts.efficiency = new Chart(efficiencyCtx, {
                type: 'line',
                data: {
                    labels: ['ç¬¬1é€±', 'ç¬¬2é€±', 'ç¬¬3é€±', 'ç¬¬4é€±'],
                    datasets: [
                        {
                            label: 'æå¤§æ˜',
                            data: [94, 95, 97, 97],
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ç‹å°è¯',
                            data: [92, 94, 95, 95],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'å¼µå¿—å‰',
                            data: [90, 91, 93, 92],
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // é…é€æ™‚é–“åˆ†å¸ƒåœ–
            const timeCtx = document.getElementById('timeDistributionChart').getContext('2d');
            performanceCharts.timeDistribution = new Chart(timeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['<30åˆ†', '30-45åˆ†', '45-60åˆ†', '>60åˆ†'],
                    datasets: [{
                        data: [25, 45, 25, 5],
                        backgroundColor: [
                            '#27ae60',
                            '#3498db',
                            '#f39c12',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // ç¸¾æ•ˆè©•åˆ†é›·é”åœ–
            const performanceCtx = document.getElementById('performanceRadarChart').getContext('2d');
            performanceCharts.performance = new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: ['æº–æ™‚æ€§', 'æ•ˆç‡', 'å®¢æˆ¶è©•åƒ¹', 'å®Œæˆç‡', 'é…åˆåº¦'],
                    datasets: [
                        {
                            label: 'æå¤§æ˜',
                            data: [97, 96, 98, 99, 95],
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.2)',
                            pointBackgroundColor: '#27ae60'
                        },
                        {
                            label: 'ç‹å°è¯',
                            data: [95, 94, 94, 97, 93],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.2)',
                            pointBackgroundColor: '#3498db'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // æ”¶å…¥åˆ†æåœ–
            const earningsCtx = document.getElementById('earningsChart').getContext('2d');
            performanceCharts.earnings = new Chart(earningsCtx, {
                type: 'bar',
                data: {
                    labels: ['æå¤§æ˜', 'ç‹å°è¯', 'å¼µå¿—å‰'],
                    datasets: [
                        {
                            label: 'åŸºæœ¬æ”¶å…¥',
                            data: [2700, 2550, 2200],
                            backgroundColor: '#3498db'
                        },
                        {
                            label: 'ç¸¾æ•ˆçé‡‘',
                            data: [500, 300, 200],
                            backgroundColor: '#27ae60'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // è¼‰å…¥å¤–é€å“¡æ’å
        function loadDriverRanking() {
            const rankingList = document.getElementById('driverRankingList');
            
            // æŒ‰ç¶œåˆè©•åˆ†æ’åº
            const sortedDrivers = sampleDriverData.sort((a, b) => {
                const scoreA = (a.onTimeRate + a.rating * 20 + a.efficiency) / 3;
                const scoreB = (b.onTimeRate + b.rating * 20 + b.efficiency) / 3;
                return scoreB - scoreA;
            });
            
            driverData = sortedDrivers;
            
            rankingList.innerHTML = sortedDrivers.map((driver, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                const statusClass = `status-${driver.status}`;
                const statusText = driver.status === 'online' ? 'åœ¨ç·š' : driver.status === 'busy' ? 'å¿™ç¢Œ' : 'é›¢ç·š';
                
                return `
                    <div class="driver-row" onclick="showDriverDetails(${driver.id})">
                        <div class="rank-badge ${rankClass}">${rank}</div>
                        <div class="driver-info">
                            <div class="driver-avatar">${driver.name.charAt(0)}</div>
                            <div>
                                <div class="driver-name">${driver.name}</div>
                                <div class="driver-details">${driver.phone} â€¢ ${driver.vehicle}</div>
                            </div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-value">${driver.deliveries}</div>
                            <div class="metric-change positive">+${Math.floor(Math.random() * 20)}%</div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-value">${driver.onTimeRate}%</div>
                            <div class="metric-change ${driver.onTimeRate > 95 ? 'positive' : 'neutral'}">
                                ${driver.onTimeRate > 95 ? '+' : ''}${(Math.random() * 4 - 2).toFixed(1)}%
                            </div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-value">${driver.avgTime}åˆ†</div>
                            <div class="metric-change ${driver.avgTime < 40 ? 'positive' : 'negative'}">
                                ${driver.avgTime < 40 ? '-' : '+'}${Math.floor(Math.random() * 5)}åˆ†
                            </div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-value rating-stars">
                                ${'â˜…'.repeat(Math.floor(driver.rating))}${'â˜†'.repeat(5 - Math.floor(driver.rating))}
                            </div>
                            <div class="metric-value">${driver.rating}</div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-value">$${driver.monthlyEarnings.toLocaleString()}</div>
                            <div class="metric-change positive">+${Math.floor(Math.random() * 15)}%</div>
                        </div>
                        <div>
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // æ›´æ–°ç¸¾æ•ˆæ‘˜è¦
        function updatePerformanceSummary() {
            const totalDeliveries = driverData.reduce((sum, driver) => sum + driver.deliveries, 0);
            const avgEfficiency = driverData.reduce((sum, driver) => sum + driver.efficiency, 0) / driverData.length;
            const avgSatisfaction = driverData.reduce((sum, driver) => sum + driver.rating, 0) / driverData.length;
            const avgEarnings = driverData.reduce((sum, driver) => sum + driver.monthlyEarnings, 0) / driverData.length;
            
            document.getElementById('totalDeliveries').textContent = totalDeliveries;
            document.getElementById('avgEfficiency').textContent = avgEfficiency.toFixed(1) + '%';
            document.getElementById('avgSatisfaction').textContent = avgSatisfaction.toFixed(1);
            document.getElementById('avgEarnings').textContent = '$' + avgEarnings.toLocaleString();
        }
        
        // é¡¯ç¤ºå¤–é€å“¡è©³æƒ…
        function showDriverDetails(driverId) {
            const driver = driverData.find(d => d.id === driverId);
            if (!driver) return;
            
            currentSelectedDriver = driver;
            
            // æ›´æ–°è©³æƒ…é¢æ¿
            document.getElementById('selectedDriverName').textContent = `${driver.name} çš„ç¸¾æ•ˆè©³æƒ…`;
            document.getElementById('detailTotalDeliveries').textContent = driver.deliveries;
            document.getElementById('detailSuccessRate').textContent = driver.successRate + '%';
            document.getElementById('detailAvgTime').textContent = driver.avgTime + 'åˆ†é˜';
            document.getElementById('detailOnTimeRate').textContent = driver.onTimeRate + '%';
            document.getElementById('detailAvgRating').textContent = driver.rating + '/5.0';
            document.getElementById('detailFiveStars').textContent = Math.floor(driver.deliveries * (driver.rating - 4)) + 'å€‹';
            document.getElementById('detailComplaints').textContent = driver.complaints + 'æ¬¡';
            document.getElementById('detailPraises').textContent = driver.praises + 'æ¬¡';
            document.getElementById('detailMonthlyEarnings').textContent = '$' + driver.monthlyEarnings.toLocaleString();
            document.getElementById('detailAvgEarnings').textContent = '$' + Math.round(driver.monthlyEarnings / driver.deliveries);
            document.getElementById('detailBonus').textContent = '$' + driver.bonus.toLocaleString();
            document.getElementById('detailRankBonus').textContent = '$' + (driver.bonus / 2);
            
            // é¡¯ç¤ºè©³æƒ…é¢æ¿
            document.getElementById('driverDetailsPanel').style.display = 'block';
        }
        
        // é—œé–‰å¤–é€å“¡è©³æƒ…
        function closeDriverDetails() {
            document.getElementById('driverDetailsPanel').style.display = 'none';
            currentSelectedDriver = null;
        }
        
        // åˆ·æ–°è³‡æ–™
        function refreshData() {
            showLoading(true);
            
            // æ¨¡æ“¬APIèª¿ç”¨
            setTimeout(() => {
                // é‡æ–°è¼‰å…¥æ‰€æœ‰è³‡æ–™
                loadDriverRanking();
                updatePerformanceSummary();
                
                // æ›´æ–°åœ–è¡¨
                Object.values(performanceCharts).forEach(chart => {
                    if (chart && chart.update) {
                        chart.update();
                    }
                });
                
                showLoading(false);
                showNotification('ğŸ“Š ç¸¾æ•ˆè³‡æ–™å·²æ›´æ–°', 'success');
            }, 1500);
        }
        
        // é¡¯ç¤º/éš±è—è¼‰å…¥é®ç½©
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }
        
        // åŒ¯å‡ºåœ–è¡¨
        function exportChart(chartType) {
            const chart = performanceCharts[chartType];
            if (chart) {
                const url = chart.toBase64Image();
                const link = document.createElement('a');
                link.download = `${chartType}_performance_chart.png`;
                link.href = url;
                link.click();
                showNotification('ğŸ“Š åœ–è¡¨å·²åŒ¯å‡º', 'success');
            }
        }
        
        // åŒ¯å‡ºè¡¨æ ¼
        function exportTable() {
            // æ¨¡æ“¬ExcelåŒ¯å‡º
            showNotification('ğŸ“„ Excelæª”æ¡ˆæº–å‚™ä¸­...', 'info');
            setTimeout(() => {
                showNotification('âœ… Excelæª”æ¡ˆå·²ä¸‹è¼‰', 'success');
            }, 2000);
        }
        
        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            
            const bgColor = {
                success: '#27ae60',
                warning: '#f39c12',
                error: '#e74c3c',
                info: '#3498db'
            }[type] || '#3498db';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 6px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
        
        // æ™‚é–“ç¯„åœæ”¹è®Šäº‹ä»¶
        document.getElementById('timeRange').addEventListener('change', function() {
            refreshData();
        });
        
        // å¤–é€å“¡ç¯©é¸æ”¹è®Šäº‹ä»¶
        document.getElementById('driverFilter').addEventListener('change', function() {
            const selectedDriver = this.value;
            
            if (selectedDriver === 'all') {
                loadDriverRanking();
            } else {
                // ç¯©é¸ç‰¹å®šå¤–é€å“¡
                const filteredData = sampleDriverData.filter(d => d.id == selectedDriver);
                driverData = filteredData;
                loadDriverRanking();
            }
            
            updatePerformanceSummary();
        });
    </script>
</body>
</html>