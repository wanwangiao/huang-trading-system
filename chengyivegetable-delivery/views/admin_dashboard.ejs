<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª æ„é®®è”¬ - ç®¡ç†å„€è¡¨æ¿</title>
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Maps API will be loaded at the bottom with proper key -->
</head>
<body>
    <!-- å´é‚Šå°èˆªæ¬„ -->
    <nav class="sidebar">
        <div class="logo">
            <h2>ğŸƒ èª æ„é®®è”¬</h2>
            <p>ç®¡ç†å¾Œå°</p>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item active">
                <a href="#dashboard" class="nav-link">
                    <span class="icon">ğŸ“Š</span>
                    <span>å„€è¡¨æ¿</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/orders" class="nav-link">
                    <span class="icon">ğŸ“¦</span>
                    <span>è¨‚å–®ç®¡ç†</span>
                    <span class="badge">8</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/products" class="nav-link">
                    <span class="icon">ğŸ¥¬</span>
                    <span>å•†å“ç®¡ç†</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/inventory" class="nav-link">
                    <span class="icon">ğŸ“‹</span>
                    <span>åº«å­˜ç®¡ç†</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/delivery" class="nav-link">
                    <span class="icon">ğŸš›</span>
                    <span>é…é€ç®¡ç†ä¸­å¿ƒ</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/reports" class="nav-link">
                    <span class="icon">ğŸ“ˆ</span>
                    <span>çµ±è¨ˆå ±è¡¨</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/basic-settings" class="nav-link">
                    <span class="icon">ğŸ¨</span>
                    <span>åŸºæœ¬è³‡æ–™ç®¡ç†</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/bank-settings" class="nav-link">
                    <span class="icon">ğŸ¦</span>
                    <span>éŠ€è¡Œè¨­å®š</span>
                </a>
            </li>
            <!-- å“¡å·¥ç®¡ç†å’Œç³»çµ±è¨­å®šåŠŸèƒ½å·²ç§»é™¤ -->
        </ul>
        
        <div class="user-info">
            <div class="user-avatar">ğŸ‘¤</div>
            <div class="user-details">
                <p class="user-name">é»ƒå£«å˜‰</p>
                <p class="user-role">ç³»çµ±ç®¡ç†å“¡</p>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <main class="main-content">
        <!-- é ‚éƒ¨å°èˆª -->
        <header class="top-nav">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <div class="breadcrumb">
                <span>é¦–é </span> > <span class="current">å„€è¡¨æ¿</span>
            </div>
            <div class="top-nav-actions">
                <button class="refresh-btn" onclick="refreshData()">ğŸ”„ é‡æ–°æ•´ç†</button>
                <div class="datetime">
                    <span id="current-datetime"></span>
                </div>
            </div>
        </header>

        <!-- å„€è¡¨æ¿å…§å®¹ -->
        <div class="dashboard-content" id="dashboard">
            <!-- é—œéµæŒ‡æ¨™å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card revenue">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-content">
                        <h3>ä»Šæ—¥ç‡Ÿæ¥­é¡</h3>
                        <p class="stat-value">$12,450</p>
                        <span class="stat-change positive">+8.3%</span>
                    </div>
                </div>
                
                <div class="stat-card orders">
                    <div class="stat-icon">ğŸ“¦</div>
                    <div class="stat-content">
                        <h3>ä»Šæ—¥è¨‚å–®</h3>
                        <p class="stat-value">47ç­†</p>
                        <span class="stat-change positive">+12%</span>
                    </div>
                </div>
                
                <div class="stat-card customers">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-content">
                        <h3>æœå‹™å®¢æˆ¶</h3>
                        <p class="stat-value">38äºº</p>
                        <span class="stat-change neutral">+5%</span>
                    </div>
                </div>
                
                <div class="stat-card avgorder">
                    <div class="stat-icon">ğŸ›’</div>
                    <div class="stat-content">
                        <h3>å¹³å‡å®¢å–®åƒ¹</h3>
                        <p class="stat-value">$265</p>
                        <span class="stat-change negative">-2.1%</span>
                    </div>
                </div>
            </div>

            <!-- åœ–è¡¨å€åŸŸ -->
            <div class="charts-grid">
                <!-- ç‡Ÿæ”¶è¶¨å‹¢åœ– -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>ğŸ“ˆ ç‡Ÿæ”¶è¶¨å‹¢ (æœ¬é€±)</h3>
                        <div class="chart-controls">
                            <select id="revenue-period">
                                <option value="week">æœ¬é€±</option>
                                <option value="month">æœ¬æœˆ</option>
                                <option value="year">æœ¬å¹´</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- å•†å“éŠ·å”®æ’è¡Œ -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>ğŸ† ç†±éŠ·å•†å“ TOP 5</h3>
                    </div>
                    <div class="products-ranking">
                        <div class="ranking-item">
                            <span class="rank">1</span>
                            <span class="product">ğŸ¥¬ é«˜éº—èœ</span>
                            <span class="sales">456é¡†</span>
                            <span class="revenue">$36,480</span>
                        </div>
                        <div class="ranking-item">
                            <span class="rank">2</span>
                            <span class="product">ğŸ‡ è‘¡è„</span>
                            <span class="sales">234ä¸²</span>
                            <span class="revenue">$29,250</span>
                        </div>
                        <div class="ranking-item">
                            <span class="rank">3</span>
                            <span class="product">ğŸ¥¬ å¤§ç™½èœ</span>
                            <span class="sales">189é¡†</span>
                            <span class="revenue">$22,680</span>
                        </div>
                        <div class="ranking-item">
                            <span class="rank">4</span>
                            <span class="product">ğŸ… ç•ªèŒ„</span>
                            <span class="sales">567æ–¤</span>
                            <span class="revenue">$22,110</span>
                        </div>
                        <div class="ranking-item">
                            <span class="rank">5</span>
                            <span class="product">ğŸ¥• èƒ¡è˜¿è””</span>
                            <span class="sales">345åŒ…</span>
                            <span class="revenue">$20,700</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³æ™‚ç‹€æ…‹å€åŸŸ -->
            <div class="status-grid">
                <!-- åº«å­˜è­¦ç¤º -->
                <div class="status-card inventory-alerts">
                    <h3>âš ï¸ åº«å­˜è­¦ç¤º</h3>
                    <div class="alert-list">
                        <div class="alert-item critical">
                            <span class="icon">ğŸ”´</span>
                            <span class="product">é«˜éº—èœ</span>
                            <span class="status">å‰©é¤˜ 3é¡†</span>
                            <button class="action-btn">è£œè²¨</button>
                        </div>
                        <div class="alert-item warning">
                            <span class="icon">ğŸŸ¡</span>
                            <span class="product">ç•ªèŒ„</span>
                            <span class="status">2å¤©å…§åˆ°æœŸ</span>
                            <button class="action-btn">ä¿ƒéŠ·</button>
                        </div>
                        <div class="alert-item normal">
                            <span class="icon">ğŸŸ¢</span>
                            <span class="product">è‘¡è„</span>
                            <span class="status">åº«å­˜å……è¶³</span>
                        </div>
                    </div>
                </div>

                <!-- å¾…è™•ç†äº‹é … -->
                <div class="status-card pending-tasks">
                    <h3>ğŸ“‹ å¾…è™•ç†äº‹é …</h3>
                    <div class="task-list">
                        <div class="task-item">
                            <span class="icon">ğŸ“¦</span>
                            <span class="task">å¾…æ€è²¨è¨‚å–®</span>
                            <span class="count">8ç­†</span>
                            <button class="action-btn primary">è™•ç†</button>
                        </div>
                        <div class="task-item">
                            <span class="icon">ğŸšš</span>
                            <span class="task">é…é€ä¸­è¨‚å–®</span>
                            <span class="count">12ç­†</span>
                            <button class="action-btn">è¿½è¹¤</button>
                        </div>
                        <div class="task-item">
                            <span class="icon">ğŸ’³</span>
                            <span class="task">å¾…æ”¶æ¬¾è¨‚å–®</span>
                            <span class="count">3ç­†</span>
                            <button class="action-btn">æé†’</button>
                        </div>
                    </div>
                </div>

                <!-- é…é€ç‹€æ³ -->
                <div class="status-card delivery-status">
                    <h3>ğŸ—ºï¸ é…é€ç‹€æ³</h3>
                    <div class="delivery-map-mini" id="delivery-mini-map">
                        <!-- è¿·ä½ åœ°åœ–é¡¯ç¤º -->
                        <div class="map-overlay">
                            <p>ğŸš› 5å°è»Šé…é€ä¸­</p>
                            <p>â° å¹³å‡é…é€æ™‚é–“: 42åˆ†é˜</p>
                            <p>ğŸ“ é…é€ç¯„åœ: ä¸‰å³½ã€åŒ—å¤§ã€æ¨¹æ—</p>
                            <button class="action-btn" onclick="openFullMap()">æŸ¥çœ‹å®Œæ•´åœ°åœ–</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨‚å–®ç®¡ç†é é¢ -->
        <div class="dashboard-content hidden" id="orders">
            <div class="page-header">
                <h2>ğŸ“¦ è¨‚å–®ç®¡ç†</h2>
                <div class="page-actions">
                    <button class="btn primary" onclick="exportOrders()">ğŸ“Š åŒ¯å‡ºå ±è¡¨</button>
                    <button class="btn" onclick="refreshOrders()">ğŸ”„ é‡æ–°æ•´ç†</button>
                </div>
            </div>

            <!-- è¨‚å–®ç¯©é¸ -->
            <div class="filter-bar">
                <select id="order-status-filter">
                    <option value="all">å…¨éƒ¨ç‹€æ…‹</option>
                    <option value="pending">å¾…æ€è²¨</option>
                    <option value="picking">æ€è²¨ä¸­</option>
                    <option value="packed">åŒ…è£å®Œæˆ</option>
                    <option value="delivering">é…é€ä¸­</option>
                    <option value="completed">å·²å®Œæˆ</option>
                </select>
                <input type="date" id="order-date-filter" value="2024-08-15">
                <input type="text" id="order-search" placeholder="æœå°‹è¨‚å–®è™Ÿæˆ–å®¢æˆ¶åç¨±">
                <button class="btn" onclick="filterOrders()">ğŸ” æœå°‹</button>
            </div>

            <!-- è¨‚å–®åˆ—è¡¨ -->
            <div class="orders-table">
                <table>
                    <thead>
                        <tr>
                            <th>è¨‚å–®è™Ÿ</th>
                            <th>å®¢æˆ¶</th>
                            <th>å•†å“</th>
                            <th>é‡‘é¡</th>
                            <th>ç‹€æ…‹</th>
                            <th>é…é€æ™‚é–“</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="orders-tbody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px;">
                                è¼‰å…¥è¨‚å–®æ•¸æ“šä¸­...
                                <br><br>
                                <button onclick="loadOrders()" class="btn">ğŸ”„ æ‰‹å‹•è¼‰å…¥è¨‚å–®</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é…é€åœ°åœ–é é¢ -->
        <div class="dashboard-content hidden" id="delivery">
            <div class="page-header">
                <h2>ğŸ—ºï¸ é…é€ç®¡ç†ä¸­å¿ƒ</h2>
                <div class="page-actions">
                    <button class="btn primary" onclick="optimizeRoutes()">ğŸ¯ è·¯ç·šå„ªåŒ–</button>
                    <button class="btn" onclick="assignDelivery()">ğŸ‘¨â€ğŸšš æ´¾é€å“¡å·¥</button>
                </div>
            </div>

            <div class="delivery-layout">
                <!-- åœ°åœ–å€åŸŸ -->
                <div class="map-container">
                    <div id="delivery-map"></div>
                    <div class="map-controls">
                        <button class="map-btn" onclick="centerMap()">ğŸ¯ é‡ç½®è¦–è§’</button>
                        <button class="map-btn" onclick="toggleTraffic()">ğŸš¦ äº¤é€šç‹€æ³</button>
                        <button class="map-btn" onclick="toggleRoutes()">ğŸ›£ï¸ è·¯ç·šé¡¯ç¤º</button>
                    </div>
                </div>

                <!-- é…é€å“¡ç‹€æ…‹ -->
                <div class="delivery-sidebar">
                    <h3>ğŸš› é…é€å“¡ç‹€æ…‹</h3>
                    <div class="driver-list">
                        <div class="driver-card active">
                            <div class="driver-header">
                                <span class="driver-name">ğŸ‘¨â€ğŸšš æå¤§æ˜</span>
                                <span class="vehicle">ğŸï¸ ABC-1234</span>
                            </div>
                            <div class="driver-status">
                                <p>ğŸ“ ç›®å‰ä½ç½®: ä¸‰å³½åœ‹å°é™„è¿‘</p>
                                <p>ğŸ¯ é…é€ä¸­: 3ç­†è¨‚å–®</p>
                                <p>â° é è¨ˆå®Œæˆ: 15:30</p>
                                <div class="driver-actions">
                                    <button class="btn-small" onclick="callDriver('æå¤§æ˜')">ğŸ“± è¯çµ¡</button>
                                    <button class="btn-small" onclick="trackDriver('æå¤§æ˜')">ğŸ“ è¿½è¹¤</button>
                                </div>
                            </div>
                        </div>

                        <div class="driver-card active">
                            <div class="driver-header">
                                <span class="driver-name">ğŸ‘¨â€ğŸšš ç‹å°è¯</span>
                                <span class="vehicle">ğŸš— DEF-5678</span>
                            </div>
                            <div class="driver-status">
                                <p>ğŸ“ ç›®å‰ä½ç½®: åŒ—å¤§ç‰¹å€</p>
                                <p>ğŸ¯ é…é€ä¸­: 2ç­†è¨‚å–®</p>
                                <p>â° é è¨ˆå®Œæˆ: 16:00</p>
                                <div class="driver-actions">
                                    <button class="btn-small" onclick="callDriver('ç‹å°è¯')">ğŸ“± è¯çµ¡</button>
                                    <button class="btn-small" onclick="trackDriver('ç‹å°è¯')">ğŸ“ è¿½è¹¤</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>ğŸ“Š é…é€çµ±è¨ˆ</h3>
                    <div class="delivery-stats">
                        <div class="stat-row">
                            <span>âœ… ä»Šæ—¥å®Œæˆ</span>
                            <span class="value">23ç­†</span>
                        </div>
                        <div class="stat-row">
                            <span>ğŸšš é…é€ä¸­</span>
                            <span class="value">5ç­†</span>
                        </div>
                        <div class="stat-row">
                            <span>â° æº–æ™‚ç‡</span>
                            <span class="value">94.2%</span>
                        </div>
                        <div class="stat-row">
                            <span>ğŸ“ å¹³å‡æ™‚é–“</span>
                            <span class="value">42åˆ†é˜</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/admin-dashboard.js"></script>
    
    <!-- Google Maps API -->
    <script>
        let map;
        let directionsService;
        let directionsRenderer;
        let storeMarker;
        let driverMarkers = [];
        
        // åˆå§‹åŒ– Google Maps
        function initMap() {
            // ä¸‰å³½å€èª æ„é®®è”¬ç¸½åº—ä½ç½®
            const storeLocation = { lat: 24.9348, lng: 121.3722 };
            
            map = new google.maps.Map(document.getElementById('delivery-map'), {
                zoom: 13,
                center: storeLocation,
                styles: [
                    {
                        "featureType": "poi",
                        "elementType": "labels",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "labels.icon",
                        "stylers": [{"visibility": "off"}]
                    }
                ]
            });
            
            // è¨­å®šè·¯ç·šæœå‹™
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                suppressMarkers: true,
                polylineOptions: {
                    strokeColor: '#2d5a3d',
                    strokeWeight: 4,
                    strokeOpacity: 0.8
                }
            });
            directionsRenderer.setMap(map);
            
            // æ·»åŠ ç¸½åº—æ¨™è¨˜
            storeMarker = new google.maps.Marker({
                position: storeLocation,
                map: map,
                title: 'ğŸƒ èª æ„é®®è”¬ç¸½åº—',
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="20" cy="20" r="18" fill="#2d5a3d" stroke="#fff" stroke-width="2"/>
                            <text x="20" y="28" text-anchor="middle" fill="white" font-size="20">ğŸƒ</text>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(40, 40),
                    anchor: new google.maps.Point(20, 20)
                }
            });
            
            // æ·»åŠ åº—å®¶è³‡è¨Šè¦–çª—
            const storeInfoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="padding: 10px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; color: #2d5a3d;">ğŸƒ èª æ„é®®è”¬ç¸½åº—</h3>
                        <p style="margin: 5px 0;"><strong>ğŸ“ åœ°å€:</strong> æ–°åŒ—å¸‚ä¸‰å³½å€ä¸­å±±è·¯123è™Ÿ</p>
                        <p style="margin: 5px 0;"><strong>ğŸ“ é›»è©±:</strong> 02-2345-6789</p>
                        <p style="margin: 5px 0;"><strong>â° ç‡Ÿæ¥­æ™‚é–“:</strong> 06:00-13:00</p>
                    </div>
                `
            });
            
            storeMarker.addListener('click', () => {
                storeInfoWindow.open(map, storeMarker);
            });
            
            // è¼‰å…¥é…é€å“¡ä½ç½®
            loadDriverLocations();
            
            console.log('âœ… Google Maps åœ°åœ–åˆå§‹åŒ–å®Œæˆ');
        }
        
        // è¼‰å…¥é…é€å“¡å³æ™‚ä½ç½®
        function loadDriverLocations() {
            // æ¨¡æ“¬é…é€å“¡ä½ç½®æ•¸æ“š
            const drivers = [
                {
                    id: 1,
                    name: 'æå¤§æ˜',
                    vehicle: 'ABC-1234',
                    lat: 24.9450,
                    lng: 121.3650,
                    status: 'é…é€ä¸­',
                    orders: 3,
                    phone: '0912-345-678'
                },
                {
                    id: 2,
                    name: 'ç‹å°è¯',
                    vehicle: 'DEF-5678', 
                    lat: 24.9200,
                    lng: 121.3900,
                    status: 'é…é€ä¸­',
                    orders: 2,
                    phone: '0923-456-789'
                }
            ];
            
            // æ¸…é™¤èˆŠæ¨™è¨˜
            driverMarkers.forEach(marker => marker.setMap(null));
            driverMarkers = [];
            
            // æ·»åŠ é…é€å“¡æ¨™è¨˜
            drivers.forEach(driver => {
                const driverMarker = new google.maps.Marker({
                    position: { lat: driver.lat, lng: driver.lng },
                    map: map,
                    title: `é…é€å“¡ï¼š${driver.name}`,
                    icon: {
                        url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                            <svg width="35" height="35" viewBox="0 0 35 35" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="17.5" cy="17.5" r="15" fill="#3498db" stroke="#fff" stroke-width="2"/>
                                <text x="17.5" y="25" text-anchor="middle" fill="white" font-size="16">ğŸš›</text>
                            </svg>
                        `),
                        scaledSize: new google.maps.Size(35, 35),
                        anchor: new google.maps.Point(17.5, 17.5)
                    }
                });
                
                // é…é€å“¡è³‡è¨Šè¦–çª—
                const driverInfoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 10px; min-width: 200px;">
                            <h4 style="margin: 0 0 10px 0; color: #3498db;">ğŸš› ${driver.name}</h4>
                            <p style="margin: 5px 0;"><strong>ğŸš— è»Šç‰Œ:</strong> ${driver.vehicle}</p>
                            <p style="margin: 5px 0;"><strong>ğŸ“± é›»è©±:</strong> ${driver.phone}</p>
                            <p style="margin: 5px 0;"><strong>ğŸ“¦ é…é€ä¸­:</strong> ${driver.orders} ç­†è¨‚å–®</p>
                            <p style="margin: 5px 0;"><strong>ğŸ“ ç‹€æ…‹:</strong> <span style="color: #27ae60;">${driver.status}</span></p>
                            <div style="margin-top: 10px; text-align: center;">
                                <button onclick="callDriver('${driver.phone}')" style="background: #27ae60; color: white; border: none; padding: 5px 15px; border-radius: 4px; margin-right: 5px; cursor: pointer;">ğŸ“ é€šè©±</button>
                                <button onclick="trackDriver(${driver.id})" style="background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer;">ğŸ“ è¿½è¹¤</button>
                            </div>
                        </div>
                    `
                });
                
                driverMarker.addListener('click', () => {
                    driverInfoWindow.open(map, driverMarker);
                });
                
                driverMarkers.push(driverMarker);
            });
        }
        
        // åœ°åœ–æ§åˆ¶åŠŸèƒ½
        function centerMap() {
            map.setCenter({ lat: 24.9348, lng: 121.3722 });
            map.setZoom(13);
            showNotification('ğŸ¯ åœ°åœ–è¦–è§’å·²é‡ç½®', 'info');
        }
        
        let trafficLayer = null;
        function toggleTraffic() {
            if (trafficLayer) {
                trafficLayer.setMap(null);
                trafficLayer = null;
                showNotification('ğŸš¦ äº¤é€šç‹€æ³å·²éš±è—', 'info');
            } else {
                trafficLayer = new google.maps.TrafficLayer();
                trafficLayer.setMap(map);
                showNotification('ğŸš¦ äº¤é€šç‹€æ³å·²é¡¯ç¤º', 'success');
            }
        }
        
        function toggleRoutes() {
            // ç¤ºç¯„è·¯ç·šè¦åŠƒ
            const start = { lat: 24.9348, lng: 121.3722 }; // ç¸½åº—
            const end = { lat: 24.9450, lng: 121.3650 }; // é…é€é»
            
            directionsService.route({
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.DRIVING,
                avoidTolls: true
            }, (response, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(response);
                    showNotification('ğŸ›£ï¸ é…é€è·¯ç·šå·²é¡¯ç¤º', 'success');
                } else {
                    showNotification('âŒ è·¯ç·šè¦åŠƒå¤±æ•—', 'error');
                }
            });
        }
        
        // é…é€å“¡åŠŸèƒ½
        function callDriver(phone) {
            window.open(`tel:${phone}`);
        }
        
        function trackDriver(driverId) {
            showNotification(`ğŸ“ æ­£åœ¨è¿½è¹¤å¤–é€å“¡ #${driverId}`, 'info');
            // é€™è£¡å¯ä»¥åŠ å…¥æ›´è©³ç´°çš„è¿½è¹¤åŠŸèƒ½
        }
        
        // é€šçŸ¥ç³»çµ±
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">
                        ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}
                    </span>
                    <span class="notification-message">${message}</span>
                </div>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 350px;
                font-size: 14px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // æ¯30ç§’æ›´æ–°é…é€å“¡ä½ç½®
        setInterval(loadDriverLocations, 30000);
    </script>
    
    <!-- è¼‰å…¥ Google Maps API -->
    <script async defer 
            src="https://maps.googleapis.com/maps/api/js?key=<%= googleMapsApiKey %>&libraries=geometry&callback=initMap">
    </script>
    
    <script>
        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            loadSidebarState();
        });


        // å´é‚Šæ¬„é–‹é—œåŠŸèƒ½
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            // å„²å­˜ç‹€æ…‹åˆ° localStorage
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }
        
        // è¼‰å…¥å´é‚Šæ¬„ç‹€æ…‹
        function loadSidebarState() {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                document.querySelector('.sidebar').classList.add('collapsed');
                document.querySelector('.main-content').classList.add('expanded');
            }
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-datetime').textContent = dateTimeString;
        }

        // å°èˆªåˆ‡æ›
        function showPage(pageId) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.dashboard-content').forEach(page => {
                page.classList.add('hidden');
            });
            // é¡¯ç¤ºé¸ä¸­é é¢
            document.getElementById(pageId).classList.remove('hidden');
            
            // æ›´æ–°å°èˆªç‹€æ…‹
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[href="#${pageId}"]`).parentElement.classList.add('active');
        }

        // ç¶å®šå°èˆªé»æ“Šäº‹ä»¶
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                
                // åªæ””æˆªéŒ¨é»é€£çµï¼ˆä»¥#é–‹é ­ï¼‰ï¼Œè®“çœŸå¯¦è·¯å¾‘æ­£å¸¸è·³è½‰
                if (href.startsWith('#')) {
                    e.preventDefault();
                    const pageId = href.substring(1);
                    showPage(pageId);
                }
                // å…¶ä»–é€£çµï¼ˆå¦‚ /admin/productsï¼‰è®“ç€è¦½å™¨è‡ªç„¶è·³è½‰
            });
        });
    </script>
    
    <!-- å…¨åŸŸå¿«é€Ÿå°èˆªç³»çµ± -->
    <script src="/js/global-quick-nav.js"></script>
    <link rel="stylesheet" href="/css/global-quick-nav.css">
</body>
</html>