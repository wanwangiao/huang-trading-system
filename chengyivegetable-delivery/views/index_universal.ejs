<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
  <title>èª æ„é®®è”¬ï½œå…¨é½¡å‹å–„è”¬æœè³¼ç‰© - ç‚ºæ¯ä¸€ä½æ¶ˆè²»è€…è¨­è¨ˆ</title>
  
  <!-- ç„¡éšœç¤™å’ŒSEOå„ªåŒ– -->
  <meta name="description" content="æ–°é®®è”¬æœå¤–é€ï¼Œæœå‹™ä¸‰å³½ã€æ¨¹æ—ã€é¶¯æ­Œã€åœŸåŸã€åŒ—å¤§åœ°å€ã€‚ç‚ºé•·è¼©ã€å¹´è¼•äººã€è¦–éšœæœ‹å‹éƒ½èƒ½è¼•é¬†ä½¿ç”¨çš„å‹å–„è³¼ç‰©å¹³å°">
  <meta name="keywords" content="è”¬æœå¤–é€,æ–°é®®è”¬èœ,ä¸‰å³½å¤–é€,æ¨¹æ—å¤–é€,ç„¡éšœç¤™è³¼ç‰©,é•·è¼©å‹å–„">
  
  <!-- PWAè¨­å®š -->
  <meta name="theme-color" content="#2d5a3d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="èª æ„é®®è”¬">
  
  <!-- ç„¡éšœç¤™æ”¯æ´ -->
  <meta name="color-scheme" content="light dark">
  
  <style>
    /* =================================================
       ğŸŒ SUB AGENTåœ˜éšŠ - å…¨æ°‘å‹å–„è¨­è¨ˆç³»çµ±
       å‘¨å…¨è€ƒæ…®æ‰€æœ‰æ¶ˆè²»è€…çš„ä½¿ç”¨é«”é©—
       ================================================= */
    
    /* ğŸ¨ CSS è‡ªè¨‚å±¬æ€§ - æ”¯æ´ä¸»é¡Œåˆ‡æ› */
    :root {
      /* åŸºç¤è‰²å½© */
      --primary-color: #2d5a3d;
      --accent-color: #7cb342;
      --background-color: #ffffff;
      --surface-color: #f8fffe;
      --text-primary: #1a1a1a;
      --text-secondary: #666666;
      --border-color: rgba(124, 179, 66, 0.2);
      --error-color: #d32f2f;
      --success-color: #2e7d32;
      --warning-color: #f57c00;
      
      /* å­—é«”å°ºå¯¸ - å¯èª¿æ•´ */
      --font-size-small: 0.875rem;
      --font-size-base: 1rem;
      --font-size-large: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-xxl: 1.5rem;
      
      /* é–“è·ç³»çµ± */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      
      /* è§¸æ§ç›®æ¨™æœ€å°å°ºå¯¸ */
      --min-touch-size: 44px;
      --comfortable-touch-size: 48px;
      
      /* å‹•ç•«æ™‚é–“ */
      --animation-fast: 0.15s;
      --animation-normal: 0.3s;
      --animation-slow: 0.5s;
    }
    
    /* ğŸŒ™ æ·±è‰²æ¨¡å¼æ”¯æ´ */
    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #121212;
        --surface-color: #1e1e1e;
        --text-primary: #ffffff;
        --text-secondary: #b3b3b3;
        --border-color: rgba(124, 179, 66, 0.3);
      }
    }
    
    /* ğŸ“± å‹•æ…‹æ–‡å­—å¤§å°æ”¯æ´ */
    @media (prefers-font-size: large) {
      :root {
        --font-size-small: 1rem;
        --font-size-base: 1.125rem;
        --font-size-large: 1.25rem;
        --font-size-xl: 1.5rem;
        --font-size-xxl: 1.75rem;
      }
    }
    
    /* ğŸ¯ é«˜å°æ¯”åº¦æ”¯æ´ */
    @media (prefers-contrast: high) {
      :root {
        --border-color: #000000;
        --text-secondary: #000000;
      }
      
      .product-card {
        border: 2px solid #000000 !important;
      }
      
      .btn-primary {
        border: 2px solid #000000 !important;
      }
    }
    
    /* â™¿ å‹•ç•«æ¸›å°‘æ”¯æ´ */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
    
    /* ğŸ“ åŸºç¤é‡ç½®å’Œå­—é«” */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 
        -apple-system, 
        BlinkMacSystemFont, 
        'Segoe UI', 
        'PingFang TC', 
        'Hiragino Sans GB', 
        'Microsoft JhengHei', 
        'Helvetica Neue', 
        Arial, 
        sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: var(--font-size-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color var(--animation-normal) ease;
    }
    
    /* ğŸ“± å®¹å™¨ç³»çµ± */
    .container {
      width: 100%;
      max-width: 430px;
      margin: 0 auto;
      padding: 0 var(--spacing-md);
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
        padding: 0 var(--spacing-lg);
      }
    }
    
    /* =================================================
       ğŸª é ‚éƒ¨å°èˆª - å…¨é½¡å‹å–„
       ================================================= */
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-lg) 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brand {
      display: flex;
      flex-direction: column;
    }
    
    .brand-name {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
      color: white;
    }
    
    .brand-tagline {
      font-size: var(--font-size-small);
      opacity: 0.9;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .header-actions {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    /* ğŸ”˜ æŒ‰éˆ•ç³»çµ± - è§¸æ§å‹å–„ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: var(--min-touch-size);
      min-width: var(--min-touch-size);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: 8px;
      font-size: var(--font-size-base);
      font-weight: 500;
      text-decoration: none;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .btn:focus {
      outline: 3px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    .btn-primary {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    
    .btn-primary:hover,
    .btn-primary:focus {
      background-color: #6da632;
      border-color: #6da632;
    }
    
    .btn-secondary {
      background-color: transparent;
      color: var(--text-primary);
      border-color: var(--border-color);
    }
    
    .btn-secondary:hover,
    .btn-secondary:focus {
      background-color: var(--surface-color);
      border-color: var(--accent-color);
    }
    
    .btn-large {
      min-height: var(--comfortable-touch-size);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-large);
      font-weight: 600;
    }
    
    .btn-icon {
      width: var(--min-touch-size);
      height: var(--min-touch-size);
      border-radius: 50%;
      padding: 0;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    /* =================================================
       ğŸ” æœå°‹ç³»çµ± - æ™ºèƒ½è¼”åŠ©
       ================================================= */
    .search-section {
      background-color: var(--surface-color);
      padding: var(--spacing-lg) 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .search-wrapper {
      position: relative;
    }
    
    .search-input {
      width: 100%;
      min-height: var(--comfortable-touch-size);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      border: 2px solid var(--border-color);
      border-radius: 24px;
      background-color: var(--background-color);
      color: var(--text-primary);
      transition: all var(--animation-normal) ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.1);
    }
    
    .search-input::placeholder {
      color: var(--text-secondary);
      font-size: var(--font-size-base);
    }
    
    /* ğŸ·ï¸ åˆ†é¡æ¨™ç±¤ - æ°´å¹³æ»¾å‹• */
    .categories-section {
      background-color: var(--background-color);
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .categories-scroll {
      display: flex;
      gap: var(--spacing-sm);
      overflow-x: auto;
      padding: var(--spacing-sm) var(--spacing-md);
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: var(--accent-color) var(--surface-color);
    }
    
    .categories-scroll::-webkit-scrollbar {
      height: 4px;
    }
    
    .categories-scroll::-webkit-scrollbar-track {
      background: var(--surface-color);
      border-radius: 2px;
    }
    
    .categories-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 2px;
    }
    
    .category-btn {
      flex-shrink: 0;
      min-height: var(--min-touch-size);
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-base);
      font-weight: 500;
      white-space: nowrap;
      border-radius: 22px;
      background-color: var(--surface-color);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      cursor: pointer;
      transition: all var(--animation-normal) ease;
    }
    
    .category-btn:hover,
    .category-btn:focus,
    .category-btn.active {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    
    /* =================================================
       ğŸ“¢ æœå‹™å…¬å‘Š - è³‡è¨Šé€æ˜
       ================================================= */
    .service-info {
      background-color: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin: var(--spacing-lg) var(--spacing-md);
      overflow: hidden;
    }
    
    .service-header {
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      min-height: var(--min-touch-size);
    }
    
    .service-title {
      font-size: var(--font-size-large);
      font-weight: 600;
      margin: 0;
    }
    
    .service-toggle {
      background: none;
      border: none;
      color: white;
      font-size: var(--font-size-large);
      cursor: pointer;
      min-width: var(--min-touch-size);
      min-height: var(--min-touch-size);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color var(--animation-normal) ease;
    }
    
    .service-toggle:hover,
    .service-toggle:focus {
      background-color: rgba(255, 255, 255, 0.1);
      outline: 2px solid rgba(255, 255, 255, 0.3);
      outline-offset: 2px;
    }
    
    .service-content {
      padding: var(--spacing-lg);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-lg);
    }
    
    .service-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background-color: var(--background-color);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .service-icon {
      font-size: var(--font-size-xl);
      flex-shrink: 0;
    }
    
    .service-text {
      flex: 1;
    }
    
    .service-text strong {
      display: block;
      font-size: var(--font-size-large);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .service-text span {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    /* =================================================
       ğŸ›ï¸ å•†å“å±•ç¤º - ç„¡éšœç¤™å¡ç‰‡
       ================================================= */
    .products-section {
      padding: var(--spacing-xl) 0 120px;
      background-color: var(--background-color);
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-lg);
      padding: 0 var(--spacing-md);
    }
    
    @media (max-width: 600px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--spacing-md);
      }
    }
    
    @media (max-width: 400px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .product-card {
      background-color: var(--background-color);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: var(--spacing-lg);
      transition: all var(--animation-normal) ease;
      cursor: pointer;
      position: relative;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }
    
    .product-card:hover,
    .product-card:focus-within {
      border-color: var(--accent-color);
      box-shadow: 0 4px 16px rgba(124, 179, 66, 0.15);
      transform: translateY(-2px);
    }
    
    .product-card:focus {
      outline: 3px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    .product-image {
      text-align: center;
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-lg);
      background-color: var(--surface-color);
      border-radius: 8px;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .product-emoji {
      font-size: 4rem;
      line-height: 1;
    }
    
    .product-image img {
      max-width: 100%;
      max-height: 120px;
      object-fit: cover;
      border-radius: 6px;
    }
    
    .product-info {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .product-name {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      line-height: 1.3;
    }
    
    .product-price {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      color: var(--accent-color);
      margin-bottom: var(--spacing-sm);
    }
    
    .product-unit {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
    }
    
    .product-badge {
      display: inline-block;
      background-color: #fff3e0;
      color: #f57c00;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: 16px;
      font-size: var(--font-size-small);
      font-weight: 500;
      border: 1px solid #ffcc02;
      margin-bottom: var(--spacing-md);
    }
    
    .product-actions {
      margin-top: auto;
      display: flex;
      gap: var(--spacing-sm);
    }
    
    .quick-add-btn {
      flex: 1;
      min-height: var(--comfortable-touch-size);
      background-color: var(--accent-color);
      color: white;
      border: 2px solid var(--accent-color);
      border-radius: 8px;
      font-size: var(--font-size-base);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }
    
    .quick-add-btn:hover,
    .quick-add-btn:focus {
      background-color: #6da632;
      border-color: #6da632;
      transform: translateY(-1px);
    }
    
    .detail-btn {
      min-width: var(--comfortable-touch-size);
      min-height: var(--comfortable-touch-size);
      background-color: var(--surface-color);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .detail-btn:hover,
    .detail-btn:focus {
      border-color: var(--accent-color);
      background-color: var(--accent-color);
      color: white;
    }
    
    /* =================================================
       ğŸ›’ è³¼ç‰©è»Š - å›ºå®šåº•éƒ¨
       ================================================= */
    .cart-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--primary-color);
      color: white;
      padding: var(--spacing-lg);
      box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.1);
      z-index: 200;
      transform: translateY(100%);
      transition: transform var(--animation-normal) ease;
    }
    
    .cart-bar.visible {
      transform: translateY(0);
    }
    
    .cart-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 430px;
      margin: 0 auto;
    }
    
    .cart-info {
      flex: 1;
    }
    
    .cart-total {
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
    }
    
    .cart-count {
      font-size: var(--font-size-base);
      opacity: 0.9;
    }
    
    .cart-btn {
      min-width: var(--comfortable-touch-size);
      min-height: var(--comfortable-touch-size);
      background-color: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-xl);
    }
    
    .cart-btn:hover,
    .cart-btn:focus {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    /* =================================================
       ğŸ­ æ¨¡æ…‹æ¡†ç³»çµ±
       ================================================= */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-lg);
      opacity: 0;
      visibility: hidden;
      transition: all var(--animation-normal) ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background-color: var(--background-color);
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      max-height: 90vh;
      overflow: hidden;
      transform: scale(0.9) translateY(20px);
      transition: transform var(--animation-normal) ease;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .modal-overlay.active .modal {
      transform: scale(1) translateY(0);
    }
    
    .modal-header {
      background-color: var(--accent-color);
      color: white;
      padding: var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      margin: 0;
    }
    
    .modal-close {
      width: var(--min-touch-size);
      height: var(--min-touch-size);
      background: none;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--animation-normal) ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-large);
    }
    
    .modal-close:hover,
    .modal-close:focus {
      background-color: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }
    
    .modal-body {
      padding: var(--spacing-lg);
      overflow-y: auto;
      max-height: calc(90vh - 120px);
    }
    
    /* =================================================
       ğŸ’¬ ç”¨æˆ¶å›é¥‹ç³»çµ±
       ================================================= */
    .feedback-toast {
      position: fixed;
      top: var(--spacing-lg);
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--success-color);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: 8px;
      font-weight: 500;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--animation-normal) ease;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }
    
    .feedback-toast.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    
    .feedback-toast.error {
      background-color: var(--error-color);
    }
    
    .feedback-toast.warning {
      background-color: var(--warning-color);
    }
    
    /* =================================================
       ğŸ”§ å·¥å…·é¡åˆ¥
       ================================================= */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: white;
      padding: 8px;
      text-decoration: none;
      z-index: 1001;
      border-radius: 4px;
    }
    
    .skip-link:focus {
      top: 6px;
    }
    
    .loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-color);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* =================================================
       ğŸ“± éŸ¿æ‡‰å¼æ–·é»
       ================================================= */
    @media (max-width: 480px) {
      .container {
        padding: 0 var(--spacing-sm);
      }
      
      .service-content {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }
      
      .product-card {
        padding: var(--spacing-md);
      }
      
      .product-actions {
        flex-direction: column;
      }
    }
    
    @media (min-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      }
    }
  </style>
</head>

<body>
  <!-- â™¿ ç„¡éšœç¤™è·³è½‰é€£çµ -->
  <a href="#main" class="skip-link">è·³åˆ°ä¸»è¦å…§å®¹</a>
  
  <!-- ğŸª ç¶²ç«™æ¨™é¡Œ -->
  <header class="header" role="banner">
    <div class="container">
      <div class="header-content">
        <div class="brand">
          <h1 class="brand-name">èª æ„é®®è”¬</h1>
          <p class="brand-tagline">æ–°é®®è”¬æœï½œå…¨é½¡å‹å–„è³¼ç‰©</p>
        </div>
        
        <div class="header-actions" role="navigation" aria-label="ä½¿ç”¨è€…åŠŸèƒ½">
          <% if (sessionLine) { %>
            <span class="btn btn-icon" aria-label="LINE å·²ç¶å®š" title="LINE å·²ç¶å®š">
              âœ…
            </span>
          <% } else { %>
            <a href="/auth/line/login" class="btn btn-icon" aria-label="ç¶å®š LINE å¸³è™Ÿ">
              ğŸ“±
            </a>
          <% } %>
          
          <button class="btn btn-icon" onclick="toggleTheme()" aria-label="åˆ‡æ›æ·±æ·ºè‰²ä¸»é¡Œ" id="theme-toggle">
            ğŸŒ™
          </button>
          
          <button class="btn btn-icon" onclick="toggleFontSize()" aria-label="èª¿æ•´å­—é«”å¤§å°" id="font-toggle">
            Aa
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- ğŸ” æœå°‹åŠŸèƒ½ -->
  <section class="search-section" role="search">
    <div class="container">
      <div class="search-wrapper">
        <label for="search-input" class="sr-only">æœå°‹å•†å“</label>
        <input 
          type="search" 
          id="search-input"
          class="search-input"
          placeholder="æœå°‹æ–°é®®è”¬æœå•†å“..."
          autocomplete="off"
          role="searchbox"
          aria-describedby="search-help">
        <div id="search-help" class="sr-only">è¼¸å…¥å•†å“åç¨±é€²è¡Œæœå°‹</div>
      </div>
    </div>
  </section>

  <!-- ğŸ·ï¸ å•†å“åˆ†é¡ -->
  <section class="categories-section" role="navigation" aria-label="å•†å“åˆ†é¡">
    <div class="container">
      <div class="categories-scroll" role="tablist">
        <button class="category-btn active" data-category="all" role="tab" aria-selected="true" aria-controls="products-grid">
          ğŸŒŸ å…¨éƒ¨å•†å“
        </button>
        <button class="category-btn" data-category="leafy" role="tab" aria-selected="false" aria-controls="products-grid">
          ğŸ¥¬ è‘‰èœé¡
        </button>
        <button class="category-btn" data-category="root" role="tab" aria-selected="false" aria-controls="products-grid">
          ğŸ¥• æ ¹è–é¡
        </button>
        <button class="category-btn" data-category="fruits" role="tab" aria-selected="false" aria-controls="products-grid">
          ğŸ æ°´æœé¡
        </button>
        <button class="category-btn" data-category="herbs" role="tab" aria-selected="false" aria-controls="products-grid">
          ğŸŒ¿ èª¿æ–™é¦™è‰
        </button>
        <button class="category-btn" data-category="proxy" role="tab" aria-selected="false" aria-controls="products-grid">
          ğŸ“¦ ä»£è³¼å•†å“
        </button>
      </div>
    </div>
  </section>

  <!-- ğŸ“¢ æœå‹™è³‡è¨Š -->
  <section class="service-info" role="region" aria-labelledby="service-title">
    <div class="service-header" onclick="toggleServiceInfo()" role="button" aria-expanded="false" aria-controls="service-content" tabindex="0">
      <h2 class="service-title" id="service-title">ğŸ“¢ æœå‹™è³‡è¨Š</h2>
      <button class="service-toggle" aria-label="å±•é–‹æˆ–æ”¶åˆæœå‹™è³‡è¨Š" id="service-toggle">
        â–¼
      </button>
    </div>
    
    <div class="service-content" id="service-content" aria-hidden="false">
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">ğŸšš</div>
        <div class="service-text">
          <strong>é…é€ç¯„åœ</strong>
          <span>ä¸‰å³½ã€åŒ—å¤§ç‰¹å€ã€é¶¯æ­Œã€æ¨¹æ—ã€åœŸåŸåœ°å€</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">ğŸ’°</div>
        <div class="service-text">
          <strong>å¤–é€é–€æª»</strong>
          <span>å–®ç­†è¨‚å–®æ»¿ 200 å…ƒäº«å…è²»å¤–é€</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">ğŸ’³</div>
        <div class="service-text">
          <strong>ä»˜æ¬¾æ–¹å¼</strong>
          <span>ç¾é‡‘ã€LINE Payã€éŠ€è¡Œè½‰å¸³</span>
        </div>
      </div>
      
      <div class="service-item">
        <div class="service-icon" aria-hidden="true">â°</div>
        <div class="service-text">
          <strong>é…é€æ™‚é–“</strong>
          <span>ç•¶å¤©11é»å‰ä¸‹å–®ï¼Œç•¶æ—¥æ–°é®®é€é”</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ğŸ›ï¸ å•†å“å±•ç¤º -->
  <main class="products-section" role="main" id="main">
    <div class="container">
      <h2 class="sr-only">å•†å“åˆ—è¡¨</h2>
      
      <% if (!products || products.length === 0) { %>
        <div role="status" aria-live="polite" style="text-align: center; padding: 3rem 1rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem;" aria-hidden="true">ğŸ¥¬</div>
          <h3 style="font-size: var(--font-size-xl); margin-bottom: 0.5rem;">æš«ç„¡å•†å“</h3>
          <p style="color: var(--text-secondary); margin-bottom: 2rem;">è«‹ç¨å¾Œå†è©¦æˆ–è¯çµ¡å®¢æœ</p>
          <button onclick="location.reload()" class="btn btn-primary btn-large">
            é‡æ–°è¼‰å…¥
          </button>
        </div>
      <% } else { %>
        <div class="products-grid" id="products-grid" role="tabpanel" aria-labelledby="category-all">
          <% products.forEach(function(product) { %>
            <article class="product-card" 
                     data-category="<%= product.is_priced_item ? 'proxy' : 'leafy' %>"
                     role="article"
                     aria-labelledby="product-<%= product.id %>-name"
                     tabindex="0">
              
              <div class="product-image" role="img" aria-label="<%= product.name %> å•†å“åœ–ç‰‡">
                <% if (product.image_url && product.image_url.startsWith('/uploads/')) { %>
                  <img src="<%= product.image_url %>" 
                       alt="<%= product.name %>" 
                       loading="lazy"
                       onerror="this.parentElement.innerHTML='<div class=&quot;product-emoji&quot;>ğŸ¥¬</div>'">
                <% } else if (product.image_url) { %>
                  <div class="product-emoji" aria-hidden="true"><%= product.image_url %></div>
                <% } else { %>
                  <div class="product-emoji" aria-hidden="true">ğŸ¥¬</div>
                <% } %>
              </div>
              
              <div class="product-info">
                <h3 class="product-name" id="product-<%= product.id %>-name">
                  <%= product.name %>
                </h3>
                
                <% if (product.is_priced_item) { %>
                  <div class="product-price" aria-label="æ™‚åƒ¹å•†å“">æ™‚åƒ¹</div>
                  <div class="product-unit">ä¾é‡é‡è¨ˆç®—</div>
                  <div class="product-badge">è¨ˆåƒ¹å•†å“</div>
                <% } else { %>
                  <div class="product-price" aria-label="åƒ¹æ ¼ <%= product.price %> å…ƒ">$<%= product.price %></div>
                  <div class="product-unit">/ <%= product.unit || 'ä»½' %></div>
                <% } %>
                
                <div class="product-actions">
                  <button class="quick-add-btn" 
                          onclick="quickAddToCart(<%= product.id %>)"
                          aria-describedby="product-<%= product.id %>-name"
                          <% if (product.is_priced_item) { %>disabled<% } %>>
                    <span aria-hidden="true">ğŸ›’</span>
                    <span>åŠ å…¥è³¼ç‰©è»Š</span>
                  </button>
                  
                  <button class="detail-btn" 
                          onclick="openProductDetail(<%= product.id %>)"
                          aria-label="æŸ¥çœ‹ <%= product.name %> è©³ç´°è³‡è¨Š">
                    <span aria-hidden="true">â„¹ï¸</span>
                  </button>
                </div>
              </div>
            </article>
          <% }) %>
        </div>
      <% } %>
    </div>
  </main>

  <!-- ğŸ›’ è³¼ç‰©è»Š -->
  <div class="cart-bar" id="cart-bar" role="complementary" aria-label="è³¼ç‰©è»Š">
    <div class="cart-content">
      <div class="cart-info">
        <div class="cart-total" aria-live="polite">
          ç¸½è¨ˆ $<span id="cart-total">0</span>
        </div>
        <div class="cart-count" aria-live="polite">
          <span id="cart-count">0</span> é …å•†å“
        </div>
      </div>
      
      <button class="cart-btn" 
              onclick="openCart()"
              aria-label="é–‹å•Ÿè³¼ç‰©è»Šï¼Œç›®å‰æœ‰ 0 é …å•†å“"
              id="cart-button">
        <span aria-hidden="true">ğŸ›’</span>
      </button>
    </div>
  </div>

  <!-- ğŸ­ å•†å“è©³æƒ…å½ˆçª— -->
  <div class="modal-overlay" id="product-modal" role="dialog" aria-labelledby="product-modal-title" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="product-modal-title">å•†å“è©³æƒ…</h2>
        <button class="modal-close" onclick="closeProductDetail()" aria-label="é—œé–‰å•†å“è©³æƒ…">
          <span aria-hidden="true">âœ•</span>
        </button>
      </div>
      
      <div class="modal-body" id="product-modal-body">
        <!-- å‹•æ…‹å…§å®¹ -->
      </div>
    </div>
  </div>

  <!-- ğŸ›’ è³¼ç‰©è»Šå½ˆçª— -->
  <div class="modal-overlay" id="cart-modal" role="dialog" aria-labelledby="cart-modal-title" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="cart-modal-title">è³¼ç‰©è»Š</h2>
        <button class="modal-close" onclick="closeCart()" aria-label="é—œé–‰è³¼ç‰©è»Š">
          <span aria-hidden="true">âœ•</span>
        </button>
      </div>
      
      <div class="modal-body" id="cart-modal-body">
        <!-- å‹•æ…‹å…§å®¹ -->
      </div>
    </div>
  </div>

  <!-- ğŸ’¬ å›é¥‹è¨Šæ¯ -->
  <div class="feedback-toast" id="feedback-toast" role="status" aria-live="polite"></div>

  <script>
    // =================================================
    // ğŸŒ å…¨æ°‘å‹å–„ JavaScript - ç„¡éšœç¤™å„ªå…ˆ
    // =================================================
    
    // ğŸ”§ å…¨åŸŸè®Šæ•¸
    const products = <%- JSON.stringify(products || []) %>;
    let cart = JSON.parse(localStorage.getItem('universalCart') || '[]');
    let currentTheme = localStorage.getItem('theme') || 'light';
    let currentFontSize = localStorage.getItem('fontSize') || 'normal';
    let isServiceExpanded = false;
    
    // ğŸ¯ é é¢åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initializeAccessibility();
      initializeTheme();
      initializeFontSize();
      initializeSearch();
      initializeCategories();
      updateCartDisplay();
      
      // è¼‰å…¥å®Œæˆé€šçŸ¥
      announceToScreenReader('é é¢è¼‰å…¥å®Œæˆï¼Œå…± ' + products.length + ' é …å•†å“');
    });
    
    // â™¿ ç„¡éšœç¤™åŠŸèƒ½åˆå§‹åŒ–
    function initializeAccessibility() {
      // éµç›¤å°èˆªæ”¯æ´
      document.addEventListener('keydown', handleKeyboardNavigation);
      
      // ç„¦é»ç®¡ç†
      setupFocusManagement();
      
      // ARIA ç‹€æ…‹ç®¡ç†
      setupAriaStates();
    }
    
    // âŒ¨ï¸ éµç›¤å°èˆªè™•ç†
    function handleKeyboardNavigation(e) {
      // ESC éµé—œé–‰å½ˆçª—
      if (e.key === 'Escape') {
        closeAllModals();
      }
      
      // Enter æˆ– Space éµå•Ÿå‹•æŒ‰éˆ•
      if ((e.key === 'Enter' || e.key === ' ') && e.target.role === 'button') {
        e.preventDefault();
        e.target.click();
      }
      
      // Tab éµç®¡ç†ç„¦é»
      if (e.key === 'Tab') {
        manageFocusWithinModals(e);
      }
    }
    
    // ğŸ¨ ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
    function initializeTheme() {
      document.documentElement.setAttribute('data-theme', currentTheme);
      updateThemeButton();
    }
    
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
      updateThemeButton();
      
      announceToScreenReader('å·²åˆ‡æ›åˆ°' + (currentTheme === 'light' ? 'æ·ºè‰²' : 'æ·±è‰²') + 'ä¸»é¡Œ');
    }
    
    function updateThemeButton() {
      const themeButton = document.getElementById('theme-toggle');
      themeButton.textContent = currentTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
      themeButton.setAttribute('aria-label', 'åˆ‡æ›åˆ°' + (currentTheme === 'light' ? 'æ·±è‰²' : 'æ·ºè‰²') + 'ä¸»é¡Œ');
    }
    
    // ğŸ“ å­—é«”å¤§å°èª¿æ•´
    function initializeFontSize() {
      document.documentElement.setAttribute('data-font-size', currentFontSize);
      updateFontButton();
    }
    
    function toggleFontSize() {
      const sizes = ['small', 'normal', 'large', 'xl'];
      const currentIndex = sizes.indexOf(currentFontSize);
      const nextIndex = (currentIndex + 1) % sizes.length;
      currentFontSize = sizes[nextIndex];
      
      document.documentElement.setAttribute('data-font-size', currentFontSize);
      localStorage.setItem('fontSize', currentFontSize);
      updateFontButton();
      
      const sizeNames = { small: 'å°', normal: 'æ¨™æº–', large: 'å¤§', xl: 'ç‰¹å¤§' };
      announceToScreenReader('å­—é«”å¤§å°å·²èª¿æ•´ç‚º' + sizeNames[currentFontSize]);
    }
    
    function updateFontButton() {
      const fontButton = document.getElementById('font-toggle');
      const sizeLabels = { small: 'Aa', normal: 'Aa', large: 'AA', xl: 'AA' };
      fontButton.textContent = sizeLabels[currentFontSize];
    }
    
    // ğŸ” æœå°‹åŠŸèƒ½
    function initializeSearch() {
      const searchInput = document.getElementById('search-input');
      let searchTimeout;
      
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performSearch(this.value);
        }, 500); // å¢åŠ é˜²æŠ–æ™‚é–“ï¼Œå°èªçŸ¥éšœç¤™å‹å–„
      });
    }
    
    function performSearch(query) {
      const cards = document.querySelectorAll('.product-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const name = card.querySelector('.product-name').textContent.toLowerCase();
        const shouldShow = !query || name.includes(query.toLowerCase());
        
        card.style.display = shouldShow ? 'flex' : 'none';
        card.setAttribute('aria-hidden', !shouldShow);
        
        if (shouldShow) visibleCount++;
      });
      
      announceToScreenReader('æœå°‹çµæœï¼šæ‰¾åˆ° ' + visibleCount + ' é …å•†å“');
    }
    
    // ğŸ·ï¸ åˆ†é¡åŠŸèƒ½
    function initializeCategories() {
      const categoryButtons = document.querySelectorAll('.category-btn');
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          setActiveCategory(this);
          filterByCategory(this.dataset.category);
        });
      });
    }
    
    function setActiveCategory(activeButton) {
      const categoryButtons = document.querySelectorAll('.category-btn');
      
      categoryButtons.forEach(button => {
        button.classList.remove('active');
        button.setAttribute('aria-selected', 'false');
      });
      
      activeButton.classList.add('active');
      activeButton.setAttribute('aria-selected', 'true');
    }
    
    function filterByCategory(category) {
      const cards = document.querySelectorAll('.product-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const cardCategory = card.dataset.category;
        const shouldShow = category === 'all' || cardCategory === category;
        
        card.style.display = shouldShow ? 'flex' : 'none';
        card.setAttribute('aria-hidden', !shouldShow);
        
        if (shouldShow) visibleCount++;
      });
      
      const categoryName = document.querySelector('[data-category="' + category + '"]').textContent;
      announceToScreenReader('å·²ç¯©é¸' + categoryName + 'ï¼Œé¡¯ç¤º ' + visibleCount + ' é …å•†å“');
    }
    
    // ğŸ“¢ æœå‹™è³‡è¨Šåˆ‡æ›
    function toggleServiceInfo() {
      const content = document.getElementById('service-content');
      const toggle = document.getElementById('service-toggle');
      const header = document.querySelector('.service-header');
      
      isServiceExpanded = !isServiceExpanded;
      
      if (isServiceExpanded) {
        content.style.display = 'grid';
        toggle.textContent = 'â–²';
        header.setAttribute('aria-expanded', 'true');
        content.setAttribute('aria-hidden', 'false');
      } else {
        content.style.display = 'none';
        toggle.textContent = 'â–¼';
        header.setAttribute('aria-expanded', 'false');
        content.setAttribute('aria-hidden', 'true');
      }
      
      announceToScreenReader('æœå‹™è³‡è¨Šå·²' + (isServiceExpanded ? 'å±•é–‹' : 'æ”¶åˆ'));
    }
    
    // ğŸ›ï¸ å•†å“ç›¸é—œåŠŸèƒ½
    function quickAddToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      if (product.is_priced_item) {
        showFeedback('è¨ˆåƒ¹å•†å“è«‹é»æ“Šè©³æƒ…æŸ¥çœ‹', 'warning');
        return;
      }
      
      addToCart(product, 1);
      showFeedback('å·²åŠ å…¥ ' + product.name + ' åˆ°è³¼ç‰©è»Š', 'success');
      announceToScreenReader('å·²åŠ å…¥ ' + product.name + ' åˆ°è³¼ç‰©è»Š');
    }
    
    function openProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const modal = document.getElementById('product-modal');
      const title = document.getElementById('product-modal-title');
      const body = document.getElementById('product-modal-body');
      
      title.textContent = product.name;
      
      body.innerHTML = `
        <div style="text-align: center; margin-bottom: var(--spacing-lg);">
          <div style="font-size: 4rem; margin-bottom: var(--spacing-md);" aria-hidden="true">
            ${product.image_url || 'ğŸ¥¬'}
          </div>
          <h3 style="font-size: var(--font-size-xxl); font-weight: 600; margin-bottom: var(--spacing-sm);">
            ${product.name}
          </h3>
          
          <div style="background-color: var(--surface-color); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg);">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); text-align: left;">
              <div><strong>ğŸŒ± ç”¢åœ°ï¼š</strong>å°ç£åœ¨åœ°</div>
              <div><strong>ğŸ“¦ åŒ…è£ï¼š</strong>ç’°ä¿åŒ…æ</div>
              <div><strong>ğŸšš é…é€ï¼š</strong>ç•¶æ—¥æ–°é®®</div>
              <div><strong>â„ï¸ ä¿å­˜ï¼š</strong>å†·è—ä¿é®®</div>
            </div>
          </div>
          
          <div style="font-size: var(--font-size-xxl); font-weight: 700; color: var(--accent-color); margin-bottom: var(--spacing-lg);">
            ${product.is_priced_item ? 'æ™‚åƒ¹ï¼ˆä¾é‡é‡è¨ˆç®—ï¼‰' : '$' + product.price + ' / ' + (product.unit || 'ä»½')}
          </div>
          
          ${!product.is_priced_item ? `
            <div style="display: flex; align-items: center; justify-content: center; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);" role="group" aria-label="æ•¸é‡é¸æ“‡">
              <button onclick="adjustQuantity(-1)" class="btn btn-secondary" aria-label="æ¸›å°‘æ•¸é‡">âˆ’</button>
              <div style="font-size: var(--font-size-xl); font-weight: 700; min-width: 60px; text-align: center; 
                          padding: var(--spacing-sm); background-color: var(--surface-color); border-radius: 8px;"
                   id="quantity-display" aria-live="polite">1</div>
              <button onclick="adjustQuantity(1)" class="btn btn-secondary" aria-label="å¢åŠ æ•¸é‡">+</button>
            </div>
            
            <button onclick="addToCartFromModal(${productId})" class="btn btn-primary btn-large" style="width: 100%;">
              åŠ å…¥è³¼ç‰©è»Š
            </button>
          ` : `
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
              æ­¤å•†å“ç‚ºè¨ˆåƒ¹å•†å“ï¼Œå¯¦éš›åƒ¹æ ¼ä¾é‡é‡è¨ˆç®—ï¼Œè«‹è¯çµ¡å®¢æœè©¢åƒ¹ã€‚
            </p>
            <button class="btn btn-secondary btn-large" style="width: 100%;" onclick="contactService()">
              è¯çµ¡å®¢æœè©¢åƒ¹
            </button>
          `}
        </div>
      `;
      
      showModal(modal);
      announceToScreenReader('å·²é–‹å•Ÿ ' + product.name + ' è©³ç´°è³‡è¨Š');
    }
    
    let currentQuantity = 1;
    
    function adjustQuantity(change) {
      currentQuantity = Math.max(1, currentQuantity + change);
      document.getElementById('quantity-display').textContent = currentQuantity;
      announceToScreenReader('æ•¸é‡å·²èª¿æ•´ç‚º ' + currentQuantity);
    }
    
    function addToCartFromModal(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      addToCart(product, currentQuantity);
      closeProductDetail();
      showFeedback('å·²åŠ å…¥ ' + currentQuantity + ' å€‹ ' + product.name + ' åˆ°è³¼ç‰©è»Š', 'success');
      announceToScreenReader('å·²åŠ å…¥ ' + currentQuantity + ' å€‹ ' + product.name + ' åˆ°è³¼ç‰©è»Š');
      
      currentQuantity = 1; // é‡ç½®
    }
    
    // ğŸ›’ è³¼ç‰©è»ŠåŠŸèƒ½
    function addToCart(product, quantity) {
      const existingItem = cart.find(item => item.id === product.id);
      
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: quantity,
          unit: product.unit || 'ä»½',
          is_priced_item: product.is_priced_item || false
        });
      }
      
      saveCart();
      updateCartDisplay();
    }
    
    function saveCart() {
      localStorage.setItem('universalCart', JSON.stringify(cart));
    }
    
    function updateCartDisplay() {
      const cartBar = document.getElementById('cart-bar');
      const totalElement = document.getElementById('cart-total');
      const countElement = document.getElementById('cart-count');
      const cartButton = document.getElementById('cart-button');
      
      let total = 0;
      let count = 0;
      
      cart.forEach(item => {
        if (!item.is_priced_item) {
          total += item.price * item.quantity;
        }
        count += item.quantity;
      });
      
      totalElement.textContent = total;
      countElement.textContent = count;
      
      // æ›´æ–°è³¼ç‰©è»ŠæŒ‰éˆ•çš„ç„¡éšœç¤™æ¨™ç±¤
      cartButton.setAttribute('aria-label', 'é–‹å•Ÿè³¼ç‰©è»Šï¼Œç›®å‰æœ‰ ' + count + ' é …å•†å“ï¼Œç¸½è¨ˆ ' + total + ' å…ƒ');
      
      if (count > 0) {
        cartBar.classList.add('visible');
      } else {
        cartBar.classList.remove('visible');
      }
    }
    
    function openCart() {
      const modal = document.getElementById('cart-modal');
      const body = document.getElementById('cart-modal-body');
      
      if (cart.length === 0) {
        body.innerHTML = `
          <div style="text-align: center; padding: var(--spacing-xxl) var(--spacing-lg);">
            <div style="font-size: 3rem; margin-bottom: var(--spacing-lg);" aria-hidden="true">ğŸ›’</div>
            <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">è³¼ç‰©è»Šæ˜¯ç©ºçš„</h3>
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">å¿«å»é¸è³¼æ–°é®®è”¬æœå§ï¼</p>
            <button onclick="closeCart()" class="btn btn-primary btn-large">ç¹¼çºŒè³¼ç‰©</button>
          </div>
        `;
      } else {
        renderCartContent(body);
      }
      
      showModal(modal);
      announceToScreenReader('å·²é–‹å•Ÿè³¼ç‰©è»Šï¼Œå…± ' + cart.length + ' ç¨®å•†å“');
    }
    
    function renderCartContent(container) {
      let subtotal = 0;
      
      const cartItemsHTML = cart.map((item, index) => {
        const itemTotal = item.is_priced_item ? 0 : item.price * item.quantity;
        subtotal += itemTotal;
        
        return `
          <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); 
                      background-color: var(--surface-color); border-radius: 8px; margin-bottom: var(--spacing-md);"
               role="listitem">
            
            <div style="flex: 1;">
              <h4 style="margin: 0 0 var(--spacing-xs) 0; font-weight: 600;">${item.name}</h4>
              <div style="font-size: var(--font-size-large); font-weight: 700; color: var(--accent-color);">
                ${item.is_priced_item ? 'æ™‚åƒ¹' : '$' + itemTotal}
              </div>
              <div style="font-size: var(--font-size-small); color: var(--text-secondary);">
                ${item.is_priced_item ? 'ä¾é‡é‡è¨ˆç®—' : '$' + item.price + ' Ã— ' + item.quantity + ' ' + item.unit}
              </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);" role="group" aria-label="${item.name} æ•¸é‡æ§åˆ¶">
              <button onclick="updateCartQuantity(${index}, -1)" 
                      class="btn btn-secondary" 
                      aria-label="æ¸›å°‘ ${item.name} æ•¸é‡"
                      ${item.quantity <= 1 ? 'disabled' : ''}>âˆ’</button>
              
              <span style="min-width: 30px; text-align: center; font-weight: 600;" aria-live="polite">${item.quantity}</span>
              
              <button onclick="updateCartQuantity(${index}, 1)" 
                      class="btn btn-secondary" 
                      aria-label="å¢åŠ  ${item.name} æ•¸é‡">+</button>
              
              <button onclick="removeFromCart(${index})" 
                      class="btn btn-secondary" 
                      aria-label="ç§»é™¤ ${item.name}"
                      style="color: var(--error-color); border-color: var(--error-color);">âœ•</button>
            </div>
          </div>
        `;
      }).join('');
      
      const deliveryFee = subtotal >= 200 ? 0 : 50;
      const total = subtotal + deliveryFee;
      
      container.innerHTML = `
        <div role="list" aria-label="è³¼ç‰©è»Šå•†å“">
          ${cartItemsHTML}
        </div>
        
        <div style="border-top: 2px solid var(--border-color); padding-top: var(--spacing-lg); margin-top: var(--spacing-lg);">
          <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
            <span>å•†å“å°è¨ˆï¼š</span>
            <span style="font-weight: 600;">$${subtotal}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
            <span>å¤–é€è²»ï¼š</span>
            <span style="font-weight: 600; color: ${deliveryFee === 0 ? 'var(--success-color)' : 'var(--text-primary)'};">
              ${deliveryFee === 0 ? 'å…è²» ğŸ‰' : '$' + deliveryFee}
            </span>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: var(--font-size-xl); font-weight: 700; 
                      color: var(--accent-color); border-top: 1px solid var(--border-color); padding-top: var(--spacing-sm);">
            <span>ç¸½è¨ˆï¼š</span>
            <span aria-live="polite">$${total}</span>
          </div>
        </div>
        
        ${subtotal < 200 ? `
          <div style="background-color: rgba(245, 124, 0, 0.1); border: 1px solid var(--warning-color); 
                      color: var(--warning-color); padding: var(--spacing-md); border-radius: 8px; 
                      margin: var(--spacing-lg) 0; text-align: center;" role="status">
            âš ï¸ é‚„å·® $${200 - subtotal} å³å¯äº«å…è²»å¤–é€
          </div>
        ` : ''}
        
        <button onclick="proceedToCheckout()" class="btn btn-primary btn-large" style="width: 100%; margin-top: var(--spacing-lg);">
          å‰å¾€çµå¸³ ($${total})
        </button>
      `;
    }
    
    function updateCartQuantity(index, change) {
      if (cart[index]) {
        cart[index].quantity = Math.max(1, cart[index].quantity + change);
        saveCart();
        updateCartDisplay();
        
        // é‡æ–°æ¸²æŸ“è³¼ç‰©è»Šå…§å®¹
        const body = document.getElementById('cart-modal-body');
        renderCartContent(body);
        
        announceToScreenReader(cart[index].name + ' æ•¸é‡å·²èª¿æ•´ç‚º ' + cart[index].quantity);
      }
    }
    
    function removeFromCart(index) {
      if (cart[index] && confirm('ç¢ºå®šè¦ç§»é™¤ ' + cart[index].name + ' å—ï¼Ÿ')) {
        const itemName = cart[index].name;
        cart.splice(index, 1);
        saveCart();
        updateCartDisplay();
        
        // é‡æ–°æ¸²æŸ“è³¼ç‰©è»Šå…§å®¹
        const body = document.getElementById('cart-modal-body');
        if (cart.length === 0) {
          closeCart();
          openCart(); // é‡æ–°é–‹å•Ÿé¡¯ç¤ºç©ºè³¼ç‰©è»Š
        } else {
          renderCartContent(body);
        }
        
        announceToScreenReader('å·²ç§»é™¤ ' + itemName);
        showFeedback('å·²ç§»é™¤ ' + itemName, 'success');
      }
    }
    
    function proceedToCheckout() {
      if (cart.length === 0) return;
      
      showFeedback('æº–å‚™å‰å¾€çµå¸³...', 'success');
      setTimeout(() => {
        window.location.href = '/checkout';
      }, 1000);
    }
    
    // ğŸ­ å½ˆçª—ç®¡ç†
    function showModal(modal) {
      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      
      // ç„¦é»ç®¡ç†
      const firstFocusableElement = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (firstFocusableElement) {
        setTimeout(() => firstFocusableElement.focus(), 100);
      }
    }
    
    function closeModal(modal) {
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
    }
    
    function closeAllModals() {
      const modals = document.querySelectorAll('.modal-overlay');
      modals.forEach(modal => closeModal(modal));
    }
    
    function closeProductDetail() {
      closeModal(document.getElementById('product-modal'));
    }
    
    function closeCart() {
      closeModal(document.getElementById('cart-modal'));
    }
    
    // ğŸ’¬ ç”¨æˆ¶å›é¥‹ç³»çµ±
    function showFeedback(message, type = 'success') {
      const toast = document.getElementById('feedback-toast');
      
      toast.textContent = message;
      toast.className = 'feedback-toast show ' + type;
      
      setTimeout(() => {
        toast.className = 'feedback-toast';
      }, 3000);
    }
    
    // ğŸ”Š è¢å¹•é–±è®€å™¨é€šçŸ¥
    function announceToScreenReader(message) {
      const announcement = document.createElement('div');
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.className = 'sr-only';
      announcement.textContent = message;
      
      document.body.appendChild(announcement);
      
      setTimeout(() => {
        document.body.removeChild(announcement);
      }, 1000);
    }
    
    // ğŸ”§ è¼”åŠ©åŠŸèƒ½
    function setupFocusManagement() {
      // ç¢ºä¿æ‰€æœ‰äº’å‹•å…ƒç´ éƒ½å¯ä»¥è¢«éµç›¤è¨ªå•
      const interactiveElements = document.querySelectorAll('button, [role="button"], [tabindex]:not([tabindex="-1"])');
      
      interactiveElements.forEach(element => {
        if (!element.hasAttribute('tabindex')) {
          element.setAttribute('tabindex', '0');
        }
      });
    }
    
    function setupAriaStates() {
      // è¨­ç½®åˆå§‹ ARIA ç‹€æ…‹
      const expandableElements = document.querySelectorAll('[aria-expanded]');
      expandableElements.forEach(element => {
        if (!element.hasAttribute('aria-expanded')) {
          element.setAttribute('aria-expanded', 'false');
        }
      });
    }
    
    function manageFocusWithinModals(e) {
      const activeModal = document.querySelector('.modal-overlay.active');
      if (!activeModal) return;
      
      const focusableElements = activeModal.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      
      if (focusableElements.length === 0) return;
      
      const firstFocusable = focusableElements[0];
      const lastFocusable = focusableElements[focusableElements.length - 1];
      
      if (e.shiftKey) {
        if (document.activeElement === firstFocusable) {
          lastFocusable.focus();
          e.preventDefault();
        }
      } else {
        if (document.activeElement === lastFocusable) {
          firstFocusable.focus();
          e.preventDefault();
        }
      }
    }
    
    // ğŸ¯ å®¢æœåŠŸèƒ½
    function contactService() {
      showFeedback('æ­£åœ¨ç‚ºæ‚¨è½‰æ¥å®¢æœ...', 'success');
      // é€™è£¡å¯ä»¥æ¥å…¥å¯¦éš›çš„å®¢æœç³»çµ±
      setTimeout(() => {
        alert('å®¢æœé›»è©±ï¼š02-2345-6789\næˆ–åŠ å…¥å®˜æ–¹ LINEï¼š@chengyi-veg');
      }, 1000);
    }
    
    // é»æ“ŠèƒŒæ™¯é—œé–‰å½ˆçª—
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        closeModal(e.target);
      }
    });
  </script>
</body>
</html>