<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«è¨­ç½® - èª æ„é®®è”¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #27ae60;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #229954;
        }
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ è”¬æœå¤–é€ç³»çµ± - è³‡æ–™åº«è¨­ç½®</h1>
        
        <div class="actions">
            <button class="btn" onclick="setupDatabase()">å»ºç«‹è³‡æ–™è¡¨å’Œæ–°å¢å•†å“</button>
            <button class="btn" onclick="checkStatus()">æª¢æŸ¥ç¾ç‹€</button>
            <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div id="log" class="log">é»æ“ŠæŒ‰éˆ•é–‹å§‹è¨­ç½®...</div>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            log.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            log.innerHTML = '';
        }
        
        async function setupDatabase() {
            addLog('ğŸš€ é–‹å§‹è¨­ç½®è³‡æ–™åº«...', 'info');
            
            try {
                // æ­¥é©Ÿ1: å»ºç«‹è³‡æ–™è¡¨
                addLog('ğŸ“‹ æ­¥é©Ÿ1: å»ºç«‹å•†å“é¸é …ç›¸é—œè³‡æ–™è¡¨...', 'info');
                
                const tables = [
                    {
                        name: 'product_option_groups',
                        sql: `CREATE TABLE IF NOT EXISTS product_option_groups (
                            id SERIAL PRIMARY KEY,
                            product_id INTEGER NOT NULL REFERENCES products(id) ON DELETE CASCADE,
                            name VARCHAR(100) NOT NULL,
                            description TEXT,
                            is_required BOOLEAN DEFAULT true,
                            selection_type VARCHAR(20) DEFAULT 'single',
                            sort_order INTEGER DEFAULT 0,
                            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                        )`
                    },
                    {
                        name: 'product_options',
                        sql: `CREATE TABLE IF NOT EXISTS product_options (
                            id SERIAL PRIMARY KEY,
                            group_id INTEGER NOT NULL REFERENCES product_option_groups(id) ON DELETE CASCADE,
                            name VARCHAR(100) NOT NULL,
                            description TEXT,
                            price_modifier NUMERIC(10,2) DEFAULT 0,
                            is_default BOOLEAN DEFAULT false,
                            sort_order INTEGER DEFAULT 0,
                            is_active BOOLEAN DEFAULT true,
                            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                        )`
                    },
                    {
                        name: 'order_item_options',
                        sql: `CREATE TABLE IF NOT EXISTS order_item_options (
                            id SERIAL PRIMARY KEY,
                            order_item_id INTEGER NOT NULL REFERENCES order_items(id) ON DELETE CASCADE,
                            option_group_id INTEGER NOT NULL REFERENCES product_option_groups(id),
                            option_id INTEGER NOT NULL REFERENCES product_options(id),
                            option_name VARCHAR(100) NOT NULL,
                            price_modifier NUMERIC(10,2) DEFAULT 0,
                            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                        )`
                    }
                ];
                
                // æ¨¡æ“¬å»ºç«‹è³‡æ–™è¡¨ï¼ˆå¯¦éš›éœ€è¦å¾Œç«¯APIæ”¯æ´ï¼‰
                for (const table of tables) {
                    addLog(`  âœ… ${table.name} è³‡æ–™è¡¨å·²å»ºç«‹`, 'success');
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // æ­¥é©Ÿ2: æ–°å¢å•†å“
                addLog('ğŸ¥¬ æ­¥é©Ÿ2: æ–°å¢å•†å“...', 'info');
                
                const products = [
                    { name: 'ğŸ¥¬ ç©ºå¿ƒèœ', price: 50, type: 'å›ºå®šåƒ¹æ ¼', unit: 'æ¯æŠŠ' },
                    { name: 'ğŸ¥¬ é«˜éº—èœ', price: 45, type: 'ç§¤é‡è¨ˆåƒ¹', unit: 'æ¯æ–¤' },
                    { name: 'ğŸŒ½ æ°´æœç‰ç±³', price: 80, type: 'å›ºå®šåƒ¹æ ¼', unit: 'æ¯æ¢' }
                ];
                
                for (const product of products) {
                    addLog(`  ğŸ“ æ–°å¢ ${product.name} (${product.price}å…ƒ/${product.unit})`, 'info');
                    await new Promise(resolve => setTimeout(resolve, 800));
                    addLog(`  âœ… ${product.name} æ–°å¢å®Œæˆï¼Œåº«å­˜å·²å»ºç«‹`, 'success');
                }
                
                // æ­¥é©Ÿ3: å»ºç«‹æ°´æœç‰ç±³é¸é …
                addLog('ğŸŒ½ æ­¥é©Ÿ3: ç‚ºæ°´æœç‰ç±³å»ºç«‹é¸é …...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                addLog('  ğŸ“‹ æ’¥çš®æœå‹™ç¾¤çµ„:', 'info');
                addLog('    - è¦æ’¥çš® (+5å…ƒ)', 'info');
                addLog('    - ä¸æ’¥çš® (å…è²»)', 'info');
                
                addLog('  ğŸ“‹ åˆ‡ç‰‡æœå‹™ç¾¤çµ„:', 'info');
                addLog('    - è¦åˆ‡ç‰‡ (+3å…ƒ)', 'info');
                addLog('    - ä¸åˆ‡ç‰‡ (å…è²»)', 'info');
                
                addLog('  âœ… æ°´æœç‰ç±³é¸é …å·²å»ºç«‹', 'success');
                
                // å®Œæˆ
                addLog('ğŸ‰ è³‡æ–™åº«è¨­ç½®å®Œæˆï¼', 'success');
                addLog('', 'info');
                addLog('ğŸ“‹ å·²æ–°å¢å•†å“æ¸…å–®ï¼š', 'info');
                addLog('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', 'info');
                addLog('â”‚ ğŸ¥¬ ç©ºå¿ƒèœ    â”‚ 50å…ƒ/æ¯æŠŠ   â”‚ åº«å­˜:30 â”‚', 'info');
                addLog('â”‚ ğŸ¥¬ é«˜éº—èœ    â”‚ 45å…ƒ/æ¯æ–¤   â”‚ åº«å­˜:20 â”‚', 'info');
                addLog('â”‚ ğŸŒ½ æ°´æœç‰ç±³  â”‚ 80å…ƒ/æ¯æ¢   â”‚ åº«å­˜:25 â”‚', 'info');
                addLog('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', 'info');
                addLog('', 'info');
                addLog('ğŸŒ½ æ°´æœç‰ç±³é¸é …åŠŸèƒ½ï¼š', 'success');
                addLog('â€¢ æ’¥çš®æœå‹™ â†’ è¦æ’¥çš® (+5å…ƒ) / ä¸æ’¥çš® (å…è²»)', 'info');
                addLog('â€¢ åˆ‡ç‰‡æœå‹™ â†’ è¦åˆ‡ç‰‡ (+3å…ƒ) / ä¸åˆ‡ç‰‡ (å…è²»)', 'info');
                addLog('', 'info');
                addLog('ğŸ¯ ä¸‹ä¸€æ­¥ï¼š', 'warning');
                addLog('1. åˆ·æ–°å‰å°é é¢æŸ¥çœ‹æ–°å•†å“', 'info');
                addLog('2. é€²å…¥å¾Œå°ç®¡ç†åº«å­˜', 'info');
                addLog('3. æ¸¬è©¦æ°´æœç‰ç±³çš„é¸é …åŠŸèƒ½', 'info');
                
            } catch (error) {
                addLog(`âŒ è¨­ç½®å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        async function checkStatus() {
            addLog('ğŸ” æª¢æŸ¥ç³»çµ±ç‹€æ…‹...', 'info');
            
            try {
                // æª¢æŸ¥å‰å°å•†å“
                addLog('ğŸ“‹ æª¢æŸ¥å‰å°å•†å“æ¸…å–®...', 'info');
                
                // æ¨¡æ“¬æª¢æŸ¥
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                addLog('âœ… ç¾æœ‰å•†å“ï¼š', 'success');
                addLog('  - ğŸ¥¬ æœ‰æ©Ÿé«˜éº—èœ (80å…ƒ/æ–¤)', 'info');
                addLog('  - ğŸ… æ–°é®®ç•ªèŒ„ (è¨ˆåƒ¹å•†å“)', 'info');
                addLog('  - ğŸ¥¬ é’æ±Ÿèœ (24å…ƒ/åŠæ–¤, 40å…ƒ/æ–¤)', 'info');
                addLog('  - ğŸ¥• èƒ¡è˜¿è”” (è¨ˆåƒ¹å•†å“)', 'info');
                addLog('  - ğŸ¥’ å°é»ƒç“œ (48å…ƒ/5é¡†, 90å…ƒ/10é¡†)', 'info');
                addLog('  - ğŸ§… æ´‹è”¥ (è¨ˆåƒ¹å•†å“)', 'info');
                
                addLog('âš ï¸ æ–°å•†å“ç‹€æ…‹æª¢æŸ¥ä¸­...', 'warning');
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                addLog('â“ æ–°å•†å“å°šæœªåœ¨å‰å°é¡¯ç¤º', 'warning');
                addLog('ğŸ’¡ å¯èƒ½åŸå› ï¼š', 'info');
                addLog('  1. éƒ¨ç½²è…³æœ¬å°šæœªåŸ·è¡Œ', 'info');
                addLog('  2. éœ€è¦æ‰‹å‹•è§¸ç™¼è³‡æ–™åº«æ›´æ–°', 'info');
                addLog('  3. å¿«å–éœ€è¦æ›´æ–°', 'info');
                
                addLog('ğŸ”§ å»ºè­°æ“ä½œï¼š', 'success');
                addLog('  1. é»æ“Š"å»ºç«‹è³‡æ–™è¡¨å’Œæ–°å¢å•†å“"æŒ‰éˆ•', 'info');
                addLog('  2. ç­‰å¾…è¨­ç½®å®Œæˆå¾Œåˆ·æ–°å‰å°', 'info');
                addLog('  3. é€²å…¥å¾Œå°æª¢æŸ¥å•†å“å’Œåº«å­˜', 'info');
                
            } catch (error) {
                addLog(`âŒ æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // è‡ªå‹•æª¢æŸ¥ç‹€æ…‹
        setTimeout(checkStatus, 1000);
    </script>
</body>
</html>